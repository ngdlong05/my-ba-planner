<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Hoạch Định Kỹ Năng BA</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải Mermaid.js để vẽ sơ đồ -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <!-- Cấu hình Tailwind với font Inter -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-in-right': 'slideInRight 0.5s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        },
                        slideInRight: {
                            '0%': { opacity: 0, transform: 'translateX(20px)' },
                            '100%': { opacity: 1, transform: 'translateX(0)' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: 0 },
                            '100%': { transform: 'scale(1)', opacity: 1 },
                        }
                    }
                },
            },
        };
    </script>
    <!-- CSS cho Loader và Giao diện -->
    <style>
        body {
            background-color: #f3f4f6;
        }
        /* Tùy chỉnh thanh cuộn */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        /* CSS cho Loader */
        #loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .mermaid {
            display: flex;
            justify-content: center;
            margin: auto;
        }
        /* Style cho các "trang" con */
        .page-container {
            background-color: white;
            padding: 1.5rem 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
    </style>
</head>

<body class="font-sans antialiased">

    <!-- Container chính -->
    <div class="container mx-auto max-w-7xl p-4 md:p-8">

        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Công Cụ Hoạch Định Kỹ Năng BA</h1>
            <p class="text-lg text-gray-600 mt-2">Xây dựng lộ trình nghề nghiệp Business Analyst của riêng bạn dựa trên dữ liệu thị trường.</p>
        </header>

        <!-- ===== TRANG LỰA CHỌN (BẮT ĐẦU) ===== -->
        <main id="selection-page" class="flex flex-col gap-8">
            <!-- Bước 1: Chọn Định Hướng -->
            <section class="page-container space-y-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-gray-200 pb-3">
                    Bước 1: Chọn Định Hướng (Tính Cách)
                </h2>
                <div class="space-y-3">
                    <label class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition cursor-pointer">
                        <input type="radio" name="persona" value="technical" class="persona-radio h-5 w-5" checked>
                        <div class="ml-3">
                            <strong class="font-semibold text-gray-900">BA Kỹ Thuật (Technical BA)</strong>
                            <p class="text-sm text-gray-500">Thích làm việc với dữ liệu, API, hệ thống.</p>
                        </div>
                    </label>
                    <label class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition cursor-pointer">
                        <input type="radio" name="persona" value="business" class="persona-radio h-5 w-5">
                        <div class="ml-3">
                            <strong class="font-semibold text-gray-900">BA Nghiệp Vụ (Business BA)</strong>
                            <p class="text-sm text-gray-500">Thích làm việc với quy trình, nghiệp vụ (Banking, ERP...).</p>
                        </div>
                    </label>
                    <label class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition cursor-pointer">
                        <input type="radio" name="persona" value="leader" class="persona-radio h-5 w-5">
                        <div class="ml-3">
                            <strong class="font-semibold text-gray-900">BA Lãnh Đạo (People BA)</strong>
                            <p class="text-sm text-gray-500">Thích làm việc với con người, đàm phán, quản lý.</p>
                        </div>
                    </label>
                </div>
            </section>

            <!-- Bước 2: Chọn Kỹ Năng -->
            <section class="page-container">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-gray-200 pb-3 mb-6">
                    Bước 2: Đánh dấu các Kỹ Năng Bạn Đã Có
                </h2>
                <div id="skills-accordion" class="space-y-4">
                    <!-- JS sẽ điền vào đây -->
                </div>
            </section>

            <!-- Bước 3: Nút tạo kế hoạch -->
            <section class="page-container">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-gray-200 pb-3 mb-6">
                    Bước 3: Tạo Lộ Trình
                </h2>
                <p class="text-gray-600 mb-4">Sau khi hoàn thành Bước 1 và 2, hãy nhấn nút này để xem lộ trình phân tích dành riêng cho bạn.</p>
                <button id="generate-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg hover:bg-blue-700 transition shadow-lg text-lg">
                    Tạo Kế Hoạch Phát Triển
                </button>
            </section>
        </main> <!-- Hết #selection-page -->

        <!-- ===== (MỚI) TRUNG TÂM LỘ TRÌNH (HUB) - ẨN ===== -->
        <main id="report-hub-page" class="hidden page-container animate-fade-in">
            <!-- Sẽ được JS điền vào -->
        </main>
        
        <!-- ===== (MỚI) TRANG CHI TIẾT VAI TRÒ - ẨN ===== -->
        <main id="persona-detail-page" class="hidden page-container animate-fade-in">
            <!-- Sẽ được JS điền vào -->
        </main>
        
        <!-- ===== (MỚI) TRANG CHI TIẾT NHÓM KỸ NĂNG - ẨN ===== -->
        <main id="skill-group-detail-page" class="hidden page-container animate-fade-in">
            <!-- Sẽ được JS điền vào -->
        </main>

    </div> <!-- Hết container -->

    <!-- ===== MODAL TỔNG QUAN (ẨN) ===== -->
    <div id="summary-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col scale-95 transform transition-transform duration-300" id="modal-content">
            <div class="p-6 border-b">
                <h3 class="text-2xl font-bold text-gray-800">Tổng quan Lựa chọn của Bạn</h3>
            </div>
            <div class="p-6 space-y-6 overflow-y-auto">
                <!-- Persona -->
                <div>
                    <h4 class="text-lg font-semibold text-blue-700">1. Định Hướng (Tính Cách)</h4>
                    <p id="modal-persona" class="text-gray-700 text-lg font-medium"></p>
                </div>
                <!-- Skills -->
                <div>
                    <h4 class="text-lg font-semibold text-blue-700">2. Kỹ Năng Hiện Có (<span id="modal-skill-count">0</span>)</h4>
                    <div id="modal-skills-list" class="flex flex-wrap gap-2 mt-2 max-h-60 overflow-y-auto p-3 bg-gray-50 rounded-lg border">
                        <span class="text-gray-500">Bạn chưa chọn kỹ năng nào.</span>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-gray-50 border-t rounded-b-2xl flex flex-col sm:flex-row justify-end gap-4">
                <button id="modal-close-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-5 rounded-lg hover:bg-gray-300 transition">
                    Chỉnh Sửa Lại
                </button>
                <button id="modal-confirm-btn" class="bg-blue-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-blue-700 transition">
                    Xác nhận & Tạo Lộ Trình
                </button>
            </div>
        </div>
    </div>
    <!-- ===== HẾT MODAL ===== -->

    <!-- ===== LOADER (ẨN) ===== -->
    <div id="loader-container" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-[60] hidden flex-col">
        <div id="loader"></div>
        <p class="text-white mt-4 text-lg">Đang phân tích và xây dựng kế hoạch...</p>
    </div>
    <!-- ===== HẾT LOADER ===== -->

    <!-- Script chính của ứng dụng -->
    <script>
        // (MỚI) Khởi tạo Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                'primaryColor': '#eff6ff', // bg-blue-50
                'primaryBorderColor': '#93c5fd', // border-blue-300
                'primaryTextColor': '#1e3a8a', // text-blue-900
                'lineColor': '#9ca3af', // gray-400
                'fontFamily': 'Inter, sans-serif'
            }
        });

        // === DỮ LIỆU TỪ BÁO CÁO PHÂN TÍCH ===
        const allSkillsData = [
            // Technical Skills
            { "id": "sql", "name": "SQL", "count": 50, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "power bi", "name": "Power BI", "count": 25, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "tableau", "name": "Tableau", "count": 17, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "ai", "name": "AI", "count": 17, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "python", "name": "Python", "count": 17, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "oracle", "name": "Oracle", "count": 14, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "api", "name": "API", "count": 13, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "etl", "name": "ETL", "count": 12, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "database", "name": "Database", "count": 10, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "azure", "name": "Azure", "count": 9, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "mysql", "name": "MySQL", "count": 8, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "cloud", "name": "Cloud", "count": 7, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "java", "name": "Java", "count": 6, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "aws", "name": "AWS", "count": 6, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "devops", "name": "DevOps", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "postgresql", "name": "PostgreSQL", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "spark", "name": "Spark", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "nosql", "name": "NoSQL", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "data warehouse", "name": "Data Warehouse", "count": 4, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "big data", "name": "Big Data", "count": 4, "category": "Kỹ Năng Kỹ Thuật" },

            // Business Skills
            { "id": "agile", "name": "Agile", "count": 64, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "scrum", "name": "Scrum", "count": 44, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "jira", "name": "Jira", "count": 28, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "requirements", "name": "Requirements", "count": 26, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "business analysis", "name": "Business Analysis", "count": 24, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "confluence", "name": "Confluence", "count": 22, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "uml", "name": "UML", "count": 18, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "bpmn", "name": "BPMN", "count": 14, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "stakeholder", "name": "Stakeholder", "count": 13, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "product owner", "name": "Product Owner", "count": 10, "category": "Kỹ Năng Nghiệp Vụ" },

            // Soft Skills
            { "id": "communication", "name": "Communication", "count": 50, "category": "Kỹ Năng Mềm" },
            { "id": "analytical", "name": "Analytical", "count": 38, "category": "Kỹ Năng Mềm" },
            { "id": "management", "name": "Management", "count": 28, "category": "Kỹ Năng Mềm" },
            { "id": "presentation", "name": "Presentation", "count": 11, "category": "Kỹ Năng Mềm" },
            { "id": "attention to detail", "name": "Attention to Detail", "count": 10, "category": "Kỹ Năng Mềm" },
            { "id": "collaboration", "name": "Collaboration", "count": 9, "category": "Kỹ Năng Mềm" },
            { "id": "critical thinking", "name": "Critical Thinking", "count": 9, "category": "Kỹ Năng Mềm" },
            { "id": "stakeholder management", "name": "Stakeholder Management", "count": 9, "category": "Kỹ Năng Mềm" },
            { "id": "negotiation", "name": "Negotiation", "count": 7, "category": "Kỹ Năng Mềm" },
            { "id": "mentoring", "name": "Mentoring", "count": 5, "category": "Kỹ Năng Mềm" },

            // Tools Platforms
            { "id": "excel", "name": "Excel", "count": 30, "category": "Công Cụ & Nền Tảng" },
            { "id": "figma", "name": "Figma", "count": 26, "category": "Công Cụ & Nền Tảng" },
            { "id": "visio", "name": "Visio", "count": 19, "category": "Công Cụ & Nền Tảng" },
            { "id": "draw.io", "name": "Draw.io", "count": 13, "category": "Công Cụ & Nền Tảng" },
            { "id": "teams", "name": "MS Teams", "count": 12, "category": "Công Cụ & Nền Tảng" },
            { "id": "powerpoint", "name": "PowerPoint", "count": 8, "category": "Công Cụ & Nền Tảng" },
            { "id": "sap", "name": "SAP", "count": 8, "category": "Công Cụ & Nền Tảng" },

            // Domain Skills
            { "id": "erp", "name": "ERP", "count": 24, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "banking", "name": "Banking", "count": 17, "category": "Kỹ Năng Lĩnh V vực" },
            { "id": "crm", "name": "CRM", "count": 16, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "fintech", "name": "Fintech", "count": 13, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "finance", "name": "Finance", "count": 13, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "education", "name": "Education", "count": 9, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "logistics", "name": "Logistics", "count": 7, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "payment", "name": "Payment", "count": 6, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "core banking", "name": "Core Banking", "count": 6, "category": "Kỹ Năng Lĩnh Vực" },

            // Languages
            { "id": "english", "name": "English", "count": 88, "category": "Ngoại Ngữ" },
            { "id": "japanese", "name": "Japanese", "count": 4, "category": "Ngoại Ngữ" },
            { "id": "chinese", "name": "Chinese", "count": 2, "category": "Ngoại Ngữ" }
        ];

        // Kỹ năng cốt lõi và mới nổi
        const coreSkillIds = ['english', 'agile', 'sql', 'communication', 'scrum'];
        const emergingSkillIds = ['sql', 'power bi', 'ai'];

        // (MỚI) Định nghĩa chi tiết vai trò
        const personaDefinitions = {
            technical: {
                title: "BA Kỹ Thuật (Technical BA)",
                description: "Tập trung vào 'LÀM THẾ NÀO' (How). Vai trò này bắc cầu giữa nghiệp vụ và đội ngũ kỹ thuật. Bạn sẽ làm việc sâu với dữ liệu, API, và cấu trúc hệ thống.",
                keySkills: ['sql', 'power bi', 'tableau', 'ai', 'python', 'database', 'api', 'etl'],
                responsibilities: [
                    "Phân tích và đặc tả yêu cầu phi chức năng (non-functional requirements) như hiệu suất, bảo mật.",
                    "Làm việc với CSDL (Database) để hiểu mô hình dữ liệu (data model).",
                    "Đặc tả API và các luồng tích hợp hệ thống (integration flows).",
                    "Hỗ trợ Dev Team gỡ lỗi (debug) và kiểm thử (testing) các tính năng phức tạp."
                ],
                caseStudy: "<strong>Ví dụ công việc:</strong> Khi công ty muốn tích hợp một cổng thanh toán mới, Technical BA sẽ là người ngồi xuống với đội ngũ kỹ thuật của bên thứ ba, đọc tài liệu API của họ, và sau đó thiết kế ra một sơ đồ trình tự (Sequence Diagram) mô tả chính xác cách hệ thống của công ty gọi và nhận dữ liệu từ API đó, bao gồm cả việc xử lý lỗi."
            },
            business: {
                title: "BA Nghiệp Vụ (Business BA)",
                description: "Tập trung vào 'CÁI GÌ' (What) và 'TẠI SAO' (Why). Vai trò này tập trung vào việc hiểu sâu các quy trình kinh doanh, xác định vấn đề và cơ hội.",
                keySkills: ['agile', 'scrum', 'requirements', 'business analysis', 'bpmn', 'uml', 'erp', 'banking', 'fintech'],
                responsibilities: [
                    "Phỏng vấn các bên liên quan (stakeholders) để tìm ra 'nỗi đau' (pain point) và nhu cầu thực sự.",
                    "Vẽ sơ đồ quy trình nghiệp vụ (Business Process Model) bằng BPMN hoặc UML.",
                    "Viết tài liệu đặc tả yêu cầu (BRD, User Stories) một cách rõ ràng, đầy đủ.",
                    "Tổ chức các buổi họp 'grooming' (làm mịn) backlog với team."
                ],
                caseStudy: "<strong>Ví dụ công việc:</strong> Khi phòng Kế toán phàn nàn rằng quy trình duyệt chi đang quá chậm, Business BA sẽ là người tổ chức các buổi phỏng vấn, ngồi xuống 'shadow' (quan sát) họ làm việc, vẽ ra quy trình hiện tại (As-Is), tìm ra các điểm nghẽn, và thiết kế một quy trình mới (To-Be) được tự động hóa trên phần mềm ERP, giúp giảm thời gian duyệt chi từ 3 ngày xuống còn 4 giờ."
            },
            leader: {
                title: "BA Lãnh Đạo (People BA / BA Lead)",
                description: "Tập trung vào 'AI' (Who) và 'CON NGƯỜI'. Vai trò này nhấn mạnh kỹ năng giao tiếp, đàm phán và quản lý.",
                keySkills: ['communication', 'management', 'stakeholder', 'stakeholder management', 'presentation', 'negotiation', 'mentoring', 'collaboration'],
                responsibilities: [
                    "Quản lý và điều phối một nhóm các BA khác trong dự án lớn.",
                    "Xây dựng và duy trì mối quan hệ với các bên liên quan cấp cao (C-level, Giám đốc dự án).",
                    "Tổ chức và thực hiện các buổi thuyết trình (Presentation) và Demo sản phẩm.",
                    "Đào tạo (mentoring) và phát triển các thành viên BA trong nhóm."
                ],
                caseStudy: "<strong>Ví dụ công việc:</strong> Trong một dự án phần mềm lớn, khi hai phòng ban (Marketing và Sales) có những yêu cầu mâu thuẫn nhau về tính năng của CRM, BA Lead sẽ là người tổ chức một buổi họp, đứng ra làm trung gian (facilitator), giúp hai bên đàm phán (negotiate) và đi đến một giải pháp dung hòa (win-win) mà vẫn đảm bảo mục tiêu chung của dự án."
            }
        };

        // (MỚI) Giải thích chi tiết về kỹ năng
        const skillDetails = {
            'sql': {
                description: "Ngôn ngữ truy vấn có cấu trúc (SQL) là công cụ nền tảng để làm việc với bất kỳ cơ sở dữ liệu quan hệ nào.",
                howItHelps: "Cho phép bạn tự mình lấy và xác minh dữ liệu, kiểm tra các giả thuyết nghiệp vụ, và hiểu sâu về cấu trúc data thay vì phải chờ đợi developer. Đây là kỹ năng phân biệt một BA 'tốt' và một BA 'xuất sắc'."
            },
            'power bi': {
                description: "Một công cụ trực quan hóa dữ liệu của Microsoft, giúp biến dữ liệu thô thành các biểu đồ và dashboard tương tác.",
                howItHelps: "Giúp bạn trình bày kết quả phân tích một cách trực quan và thuyết phục. Thay vì gửi file Excel, bạn gửi một dashboard động. Điều này giúp các sếp (stakeholders) ra quyết định nhanh hơn và chính xác hơn."
            },
            'ai': {
                description: "Trí tuệ nhân tạo (AI) đang dần được tích hợp vào các công cụ BA để phân tích dự đoán, nhận diện mẫu và tự động hóa.",
                howItHelps: "Là một BA hiểu về AI, bạn có thể đề xuất các giải pháp thông minh hơn (ví dụ: chatbot, hệ thống gợi ý sản phẩm) thay vì chỉ các tính năng cơ bản. Đây là kỹ năng 'đón đầu' giúp bạn có lợi thế cạnh tranh rất lớn."
            },
            'english': {
                description: "Ngoại ngữ, đặc biệt là tiếng Anh, là kỹ năng quan trọng nhất theo dữ liệu (88 lượt đề cập).",
                howItHelps: "Toàn bộ tài liệu chuyên ngành, tài liệu API, các khóa học tốt nhất (IIBA, PMI) đều bằng tiếng Anh. Giỏi tiếng Anh giúp bạn tiếp cận nguồn tri thức vô tận và làm việc với các đối tác, khách hàng global."
            },
            'agile': {
                description: "Là một phương pháp luận phát triển phần mềm linh hoạt, tập trung vào việc lặp lại (iteration) và phản hồi liên tục.",
                howItHelps: "Hầu hết các công ty công nghệ hiện nay đều chạy Agile/Scrum. Hiểu Agile giúp bạn hòa nhập ngay lập tức vào quy trình làm việc, biết cách viết User Story, tham gia các buổi họp (Sprint Planning, Retrospective) và giao sản phẩm nhanh chóng."
            },
            'scrum': {
                description: "Một 'framework' (khung làm việc) cụ thể và phổ biến nhất trong Agile, với các vai trò (Scrum Master, Product Owner) và sự kiện rõ ràng.",
                howItHelps: "Biết Scrum giúp bạn hiểu rõ vai trò của mình trong 'guồng máy' của team, cách team cam kết công việc, và làm thế nào để tối ưu hóa việc chuyển giao giá trị sau mỗi Sprint."
            },
            'communication': {
                description: "Kỹ năng giao tiếp là khả năng truyền đạt, lắng nghe và thấu hiểu thông tin một cách hiệu quả.",
                howItHelps: "Đây là 'dầu bôi trơn' cho mọi hoạt động của BA. Bạn dùng nó để phỏng vấn stakeholder, đàm phán yêu cầu, giải quyết xung đột, và trình bày giải pháp. Không có kỹ năng này, mọi kỹ thuật khác đều vô nghĩa."
            },
            'python': {
                description: "Ngôn ngữ lập trình đa năng, rất mạnh trong mảng Phân tích Dữ liệu và AI.",
                howItHelps: "Đối với Technical BA, Python giúp bạn làm những việc mà SQL/Excel không làm được: tự động hóa các tác vụ lặp lại (ví dụ: lấy dữ liệu từ web), xử lý các tập dữ liệu cực lớn, và thậm chí xây dựng các mô hình AI/ML đơn giản."
            },
            'requirements': {
                description: "Kỹ năng khơi gợi (Elicitation) và quản lý yêu cầu là cốt lõi của nghề BA.",
                howItHelps: "Giúp bạn đặt đúng câu hỏi để tìm ra nhu cầu 'chìm' (ẩn) của người dùng, phân biệt giữa 'Muốn' (Want) và 'Cần' (Need), và viết ra các yêu cầu rõ ràng, không mập mờ, để developer có thể lập trình đúng ngay từ đầu."
            },
            'bpmn': {
                description: "Business Process Model and Notation là một tiêu chuẩn vàng để vẽ sơ đồ quy trình nghiệp vụ.",
                howItHelps: "Giúp bạn mô hình hóa các quy trình phức tạp một cách trực quan và đồng nhất. Một biểu đồ BPMN chuẩn có thể được hiểu bởi cả sếp nghiệp vụ (để thấy luồng đi) và dev kỹ thuật (để cấu hình hệ thống)."
            },
            'management': {
                description: "Kỹ năng quản lý, bao gồm quản lý thời gian, phạm vi (scope) và con người.",
                howItHelps: "Khi bạn lên cấp (Senior/Lead), bạn không chỉ làm BA mà còn phải quản lý dự án. Kỹ năng này giúp bạn lập kế hoạch, theo dõi tiến độ, ngăn chặn 'scope creep' (yêu cầu phát sinh) và đảm bảo dự án đi đúng hướng."
            }
        };

        // Mối liên hệ kỹ năng
        const skillSynergies = {
            'sql': ['power bi', 'tableau', 'python', 'ai', 'database', 'etl'],
            'agile': ['scrum', 'jira', 'confluence'],
            'scrum': ['agile', 'jira'],
            'requirements': ['uml', 'bpmn', 'figma', 'visio', 'business analysis'],
            'communication': ['stakeholder management', 'presentation', 'negotiation', 'management'],
            'python': ['ai', 'spark', 'big data'],
            'database': ['sql', 'data warehouse', 'etl']
        };
        
        // Biến toàn cục
        let currentPlanData = {};

        // === KHỞI TẠO GIAO DIỆN ===
        document.addEventListener('DOMContentLoaded', () => {
            populateSkillsAccordion();
            document.getElementById('generate-btn').addEventListener('click', showSummaryModal);
            document.getElementById('modal-close-btn').addEventListener('click', hideSummaryModal);
            document.getElementById('modal-confirm-btn').addEventListener('click', confirmAndGenerate);
        });

        // Hàm điền các kỹ năng vào accordion
        function populateSkillsAccordion() {
            const container = document.getElementById('skills-accordion');
            const skillsByCategory = allSkillsData.reduce((acc, skill) => {
                const category = skill.category;
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(skill);
                return acc;
            }, {});

            const categoryOrder = ["Kỹ Năng Mềm", "Kỹ Năng Nghiệp Vụ", "Kỹ Năng Kỹ Thuật", "Công Cụ & Nền Tảng", "Kỹ Năng Lĩnh Vực", "Ngoại Ngữ"];
            
            for (const category of categoryOrder) {
                if (!skillsByCategory[category]) continue;

                const skills = skillsByCategory[category].sort((a,b) => b.count - a.count);
                const section = document.createElement('div');
                section.className = 'border border-gray-200 rounded-lg';

                const header = document.createElement('button');
                header.className = 'w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition rounded-t-lg';
                header.innerHTML = `
                    <span class="font-semibold text-gray-700">${category}</span>
                    <svg class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                `;

                const content = document.createElement('div');
                content.className = 'p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 border-t border-gray-200 hidden';
                
                skills.forEach(skill => {
                    const label = document.createElement('label');
                    label.className = 'flex items-center p-2 rounded hover:bg-gray-50 cursor-pointer';
                    label.innerHTML = `
                        <input type="checkbox" class="skill-checkbox h-4 w-4 rounded" value="${skill.id}">
                        <span class="ml-2 text-sm text-gray-700">${skill.name} (${skill.count} lượt)</span>
                    `;
                    content.appendChild(label);
                });

                header.addEventListener('click', () => {
                    content.classList.toggle('hidden');
                    header.querySelector('svg').classList.toggle('rotate-180');
                });
                
                section.appendChild(header);
                section.appendChild(content);
                container.appendChild(section);
            }
        }

        // Hàm tìm kỹ năng bằng ID
        function findSkillById(id) {
            const skill = allSkillsData.find(s => s.id === id);
            if (!skill) {
                const exceptions = {
                    'stakeholder management': { id: 'stakeholder management', name: 'Stakeholder Management', count: 9 },
                };
                return exceptions[id] || { id: id, name: id, count: 'N/A' };
            }
            return skill;
        }


        // === CÁC HÀM XỬ LÝ MODAL ===
        function showSummaryModal() {
            const modal = document.getElementById('summary-modal');
            const modalContent = document.getElementById('modal-content');

            const selectedPersonaValue = document.querySelector('input[name="persona"]:checked').value;
            const selectedPersonaLabel = document.querySelector(`input[value="${selectedPersonaValue}"]`).closest('label').querySelector('strong').textContent;
            const userSkills = new Set();
            const userSkillNames = [];
            document.querySelectorAll('.skill-checkbox:checked').forEach(cb => {
                userSkills.add(cb.value);
                userSkillNames.push(cb.nextElementSibling.textContent.split(' (')[0]);
            });

            currentPlanData = {
                selectedPersona: selectedPersonaValue,
                userSkills: userSkills,
                selectedPersonaLabel: selectedPersonaLabel,
                userSkillNames: userSkillNames.sort()
            };

            document.getElementById('modal-persona').textContent = selectedPersonaLabel;
            const skillsListContainer = document.getElementById('modal-skills-list');
            document.getElementById('modal-skill-count').textContent = userSkillNames.length;

            if (userSkillNames.length > 0) {
                skillsListContainer.innerHTML = '';
                userSkillNames.forEach(name => {
                    const skillTag = document.createElement('span');
                    skillTag.className = 'bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full';
                    skillTag.textContent = name;
                    skillsListContainer.appendChild(skillTag);
                });
            } else {
                skillsListContainer.innerHTML = '<span class="text-gray-500 italic">Bạn chưa chọn kỹ năng nào.</span>';
            }

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
            }, 10);
        }

        function hideSummaryModal() {
            const modal = document.getElementById('summary-modal');
            const modalContent = document.getElementById('modal-content');

            modal.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function confirmAndGenerate() {
            hideSummaryModal();
            setTimeout(runPlanGeneration, 300);
        }

        // === (MỚI) HÀM ĐIỀU HƯỚNG TRANG CHÍNH ===
        function navigateToPage(pageId, data = {}) {
            // Ẩn tất cả các trang
            document.getElementById('selection-page').classList.add('hidden');
            document.getElementById('report-hub-page').classList.add('hidden');
            document.getElementById('persona-detail-page').classList.add('hidden');
            document.getElementById('skill-group-detail-page').classList.add('hidden');

            // Xử lý và hiển thị trang được yêu cầu
            switch (pageId) {
                case 'selection':
                    document.getElementById('selection-page').classList.remove('hidden');
                    break;
                case 'hub':
                    document.getElementById('report-hub-page').classList.remove('hidden');
                    break;
                case 'persona-detail':
                    buildPersonaDetailPage();
                    document.getElementById('persona-detail-page').classList.remove('hidden');
                    break;
                case 'skill-group-detail':
                    buildSkillGroupDetailPage(data.title, data.skills, data.color);
                    document.getElementById('skill-group-detail-page').classList.remove('hidden');
                    break;
            }
            window.scrollTo(0, 0); // Cuộn lên đầu trang
        }

        // === HÀM TẠO KẾ HOẠCH (BỘ NÃO) ===
        function runPlanGeneration() {
            const loader = document.getElementById('loader-container');
            const { selectedPersona, userSkills } = currentPlanData;
            
            loader.classList.remove('hidden');
            loader.classList.add('flex');
            document.getElementById('selection-page').classList.add('hidden');

            // 1. Phân tích thiếu hụt
            const coreGap = coreSkillIds
                .filter(id => !userSkills.has(id))
                .map(findSkillById)
                .sort((a,b) => b.count - a.count);

            const emergingGap = emergingSkillIds
                .filter(id => !userSkills.has(id))
                .map(findSkillById)
                .sort((a,b) => b.count - a.count);
                
            const personaDef = personaDefinitions[selectedPersona];
            const personaGap = personaDef.keySkills
                .filter(id => !userSkills.has(id))
                .map(findSkillById)
                .sort((a, b) => b.count - a.count);

            const allRecSkills = new Set([...coreGap.map(s => s.id), ...personaGap.map(s => s.id), ...emergingGap.map(s => s.id)]);
            const allRecSkillObjects = Array.from(allRecSkills).map(id => findSkillById(id));

            // 2. Lưu kết quả vào biến toàn cục
            currentPlanData.results = {
                coreGap,
                emergingGap,
                personaGap,
                allRecSkillObjects,
                personaDef
            };

            // 3. Giả lập thời gian
            setTimeout(() => {
                // 4. Xây dựng trang Hub
                buildReportHubPage();

                // 5. Ẩn loader, hiện trang Hub
                loader.classList.add('hidden');
                loader.classList.remove('flex');
                navigateToPage('hub'); // Hiển thị trang Hub

                // 6. Chạy Mermaid
                setTimeout(() => {
                    try {
                        if (document.querySelector('.mermaid')) {
                            mermaid.run();
                        }
                    } catch (e) {
                        console.error("Lỗi khi chạy Mermaid:", e);
                    }
                }, 100);
            }, 1500);
        }

        // === (MỚI) CÁC HÀM XÂY DỰNG TRANG (BUILDERS) ===

        // Xây dựng Trang Hub (Trang điều khiển)
        function buildReportHubPage() {
            const { allRecSkillObjects, personaDef } = currentPlanData.results;
            const mermaidCode = generateMermaidCode(allRecSkillObjects);
            const hubPage = document.getElementById('report-hub-page');

            let html = `
                <div class="flex flex-col sm:flex-row justify-between sm:items-center border-b-2 border-gray-200 pb-4 mb-8 gap-4">
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-700">Trung Tâm Lộ Trình</h2>
                    <button class="nav-button w-full sm:w-auto bg-gray-200 text-gray-700 font-bold py-2 px-5 rounded-lg hover:bg-gray-300 transition shrink-0" data-page="selection">
                        &larr; Tạo Lộ Trình Mới
                    </button>
                </div>
                
                <!-- Sơ đồ Mermaid -->
                <section class="mb-8 border border-gray-200 bg-white rounded-lg p-6 shadow-sm">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Sơ Đồ Lộ Trình Đề Xuất</h3>
                    <p class="text-gray-600 mb-6">Đây là bản đồ trực quan hóa các kỹ năng bạn nên học. Nhấn vào các mục bên dưới để khám phá chi tiết.</p>
                    <div class="mermaid w-full overflow-x-auto">
                        ${mermaidCode}
                    </div>
                </section>

                <!-- Bảng điều hướng -->
                <section class="animate-fade-in" style="animation-delay: 200ms;">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Khám Phá Chi Tiết Lộ Trình</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Thẻ Vai Trò -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 flex flex-col">
                            <h4 class="text-lg font-bold text-blue-800">${personaDef.title}</h4>
                            <p class="text-blue-700 mt-2 mb-4 flex-grow">${personaDef.description}</p>
                            <button class="nav-button w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition" data-page="persona-detail">
                                Xem Chi Tiết Vai Trò &rarr;
                            </button>
                        </div>
                        
                        <!-- Thẻ Điều Hướng Chung -->
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 space-y-4">
                            <button class="nav-button w-full text-left bg-white border border-yellow-300 p-4 rounded-lg hover:shadow-md transition group" data-page="skill-group-detail" data-group="core">
                                <h4 class="font-bold text-yellow-800">Bước 1: Nhóm Kỹ Năng Cốt Lõi</h4>
                                <p class="text-sm text-gray-600 group-hover:text-black">Các kỹ năng bắt buộc phải có của mọi BA.</p>
                            </button>
                            <button class="nav-button w-full text-left bg-white border border-emerald-300 p-4 rounded-lg hover:shadow-md transition group" data-page="skill-group-detail" data-group="persona">
                                <h4 class="font-bold text-emerald-800">Bước 2: Nhóm Kỹ Năng Chuyên Sâu</h4>
                                <p class="text-sm text-gray-600 group-hover:text-black">Các kỹ năng dành riêng cho định hướng của bạn.</p>
                            </button>
                            <button class="nav-button w-full text-left bg-white border border-indigo-300 p-4 rounded-lg hover:shadow-md transition group" data-page="skill-group-detail" data-group="emerging">
                                <h4 class="font-bold text-indigo-800">Bước 3: Nhóm Kỹ Năng Mới Nổi</h4>
                                <p class="text-sm text-gray-600 group-hover:text-black">Đón đầu xu hướng và tăng lợi thế cạnh tranh.</p>
                            </button>
                        </div>
                    </div>
                </section>
            `;
            hubPage.innerHTML = html;
            addNavigationListeners(); // Gắn sự kiện cho các nút mới
        }

        // Xây dựng Trang Chi tiết Vai Trò
        function buildPersonaDetailPage() {
            const { personaDef } = currentPlanData.results;
            const page = document.getElementById('persona-detail-page');

            let html = `
                <div class="flex justify-between items-center border-b-2 border-gray-200 pb-4 mb-8">
                    <button class="nav-button bg-gray-200 text-gray-700 font-bold py-2 px-5 rounded-lg hover:bg-gray-300 transition" data-page="hub">
                        &larr; Quay Về Hub
                    </button>
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-700 text-right">${personaDef.title}</h2>
                </div>
                
                <p class="text-lg text-gray-600 leading-relaxed mb-8">${personaDef.description}</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Trách nhiệm chính -->
                    <div class="animate-slide-in-right" style="animation-delay: 100ms;">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Trách Nhiệm Chính Thường Gặp</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            ${personaDef.responsibilities.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>

                    <!-- Ví dụ tình huống -->
                    <div class="animate-slide-in-right" style="animation-delay: 200ms;">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Tình Huống Công Việc (Case Study)</h3>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-5 text-gray-700 leading-relaxed shadow-sm">
                            ${personaDef.caseStudy}
                        </div>
                    </div>
                </div>
            `;
            page.innerHTML = html;
            addNavigationListeners(); // Gắn sự kiện cho nút "Quay Về"
        }

        // Xây dựng Trang Chi tiết Nhóm Kỹ Năng
        function buildSkillGroupDetailPage(title, skills, color) {
            const page = document.getElementById('skill-group-detail-page');

            let html = `
                <div class="flex justify-between items-center border-b-2 border-gray-200 pb-4 mb-8">
                    <button class="nav-button bg-gray-200 text-gray-700 font-bold py-2 px-5 rounded-lg hover:bg-gray-300 transition" data-page="hub">
                        &larr; Quay Về Hub
                    </button>
                    <h2 class="text-2xl md:text-3xl font-bold text-${color}-700 text-right">${title}</h2>
                </div>
            `;

            if (skills.length === 0) {
                html += `<p class="text-green-700 font-medium text-lg">Tuyệt vời! Bạn đã hoàn thiện các kỹ năng trong nhóm này.</p>`;
            } else {
                html += `<div class="space-y-6">`;
                skills.forEach((skill, index) => {
                    const detail = skillDetails[skill.id] || { description: "N/A", howItHelps: "Không có mô tả chi tiết." };
                    const synergy = skillSynergies[skill.id];

                    html += `
                        <div class="border border-gray-200 rounded-lg overflow-hidden animate-slide-in-right" style="animation-delay: ${index * 100}ms;">
                            <div class="bg-${color}-100 p-4 border-b border-${color}-200">
                                <h3 class="text-xl font-bold text-${color}-800">${skill.name}</h3>
                            </div>
                            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-2">Mô Tả Kỹ Năng</h4>
                                    <p class="text-gray-600">${detail.description}</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-2">Giúp Gì Trong Công Việc?</h4>
                                    <p class="text-gray-600">${detail.howItHelps}</p>
                                </div>
                            </div>
                            ${synergy ? `
                            <div class="p-4 bg-gray-50 border-t border-gray-200">
                                <p class="text-sm text-gray-600">
                                    <svg class="w-4 h-4 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                    <strong>Bổ trợ cho:</strong> ${synergy.map(s_id => findSkillById(s_id)?.name || s_id).join(', ')}
                                </p>
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                html += `</div>`;
            }

            page.innerHTML = html;
            addNavigationListeners(); // Gắn sự kiện cho nút "Quay Về"
        }

        // Gắn sự kiện cho các nút điều hướng
        function addNavigationListeners() {
            document.querySelectorAll('.nav-button').forEach(button => {
                // Hủy sự kiện cũ để tránh gắn lặp
                button.replaceWith(button.cloneNode(true));
            });
            
            document.querySelectorAll('.nav-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const page = e.currentTarget.dataset.page;
                    const group = e.currentTarget.dataset.group;
                    
                    if (page === 'skill-group-detail') {
                        const { coreGap, personaGap, emergingGap } = currentPlanData.results;
                        if (group === 'core') {
                            navigateToPage('skill-group-detail', { title: 'Chi Tiết Kỹ Năng Cốt Lõi', skills: coreGap, color: 'yellow' });
                        } else if (group === 'persona') {
                            navigateToPage('skill-group-detail', { title: 'Chi Tiết Kỹ Năng Chuyên Sâu', skills: personaGap, color: 'emerald' });
                        } else if (group === 'emerging') {
                            navigateToPage('skill-group-detail', { title: 'Chi Tiết Kỹ Năng Mới Nổi', skills: emergingGap, color: 'indigo' });
                        }
                    } else {
                        navigateToPage(page);
                    }
                });
            });
        }

        // Hàm tạo code Mermaid (bản đã sửa lỗi)
        function generateMermaidCode(skills) {
            if (!skills || skills.length === 0) {
                return "graph TD;\n    A[Không có kỹ năng nào để đề xuất!];";
            }
            const safeId = (id) => id.replace(/[^a-zA-Z0-9]/g, '_');
            let code = "graph TD;\n";
            code += "    User(BẠN) ::: userStyle;\n\n";

            code += "    subgraph G1 [\"Bước 1: Cốt Lõi\"]\n";
            coreSkillIds.forEach(id => {
                if (skills.some(s => s.id === id)) {
                    code += `        ${safeId(id)}("${findSkillById(id).name}");\n`;
                    code += `        User --> ${safeId(id)};\n`;
                }
            });
            code += "    end\n\n";

            code += "    subgraph G2 [\"Bước 2: Chuyên Sâu\"]\n";
            personaDefinitions[currentPlanData.selectedPersona].keySkills.forEach(id => {
                if (skills.some(s => s.id === id) && !coreSkillIds.includes(id)) {
                    code += `        ${safeId(id)}("${findSkillById(id).name}");\n`;
                }
            });
            code += "    end\n\n";
            
            code += "    subgraph G3 [\"Bước 3: Mới Nổi\"]\n";
            emergingSkillIds.forEach(id => {
                if (skills.some(s => s.id === id) && !coreSkillIds.includes(id)) {
                    code += `        ${safeId(id)}("${findSkillById(id).name}");\n`;
                }
            });
            code += "    end\n\n";

            code += "    %% Liên kết bổ trợ\n";
            skills.forEach(skill => {
                const synergies = skillSynergies[skill.id];
                if (synergies) {
                    synergies.forEach(targetSkillId => {
                        if (skills.some(s => s.id === targetSkillId)) {
                            code += `    ${safeId(skill.id)} --> ${safeId(targetSkillId)};\n`;
                        }
                    });
                }
            });

            code += "\n    %% Định nghĩa Styles\n";
            code += "    classDef default fill:#fff,stroke:#ccc,stroke-width:2px,color:#333;\n";
            code += "    classDef userStyle fill:#3b82f6,stroke:#1d4ed8,stroke-width:2px,color:white,font-weight:bold;\n";
            coreSkillIds.forEach(id => {
                if (skills.some(s => s.id === id)) code += `    class ${safeId(id)} fill:#fef9c3,stroke:#facc15,stroke-width:2px;\n`;
            });
            emergingSkillIds.forEach(id => {
                if (skills.some(s => s.id === id)) code += `    class ${safeId(id)} fill:#e0e7ff,stroke:#818cf8,stroke-width:2px;\n`;
            });
            personaDefinitions[currentPlanData.selectedPersona].keySkills.forEach(id => {
                if (skills.some(s => s.id === id)) code += `    class ${safeId(id)} fill:#d1fae5,stroke:#34d399,stroke-width:2px;\n`;
            });

            return code;
        }

    </script>

</body>

</html>
