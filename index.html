<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Hoạch Định Kỹ Năng BA</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- (ĐÃ XÓA) Mermaid.js không còn cần thiết -->
    
    <!-- Cấu hình Tailwind với font Inter và màu sắc thương hiệu -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-blue': '#2563eb', // blue-600
                        'brand-indigo': '#4f46e5', // indigo-600
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-in-right': 'slideInRight 0.5s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        },
                        slideInRight: {
                            '0%': { opacity: 0, transform: 'translateX(20px)' },
                            '100%': { opacity: 1, transform: 'translateX(0)' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: 0 },
                            '100%': { transform: 'scale(1)', opacity: 1 },
                        }
                    }
                },
            },
        };
    </script>
    <!-- CSS cho Loader và Giao diện (MỚI) -->
    <style>
        body {
            background-color: #f8fafc; /* Màu nền xám nhạt (Slate-50) */
        }
        /* Tùy chỉnh thanh cuộn */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8b2c1; }
        
        /* CSS cho Loader */
        #loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3b82f6; /* Blue-500 */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* (MỚI) Style cho các "trang" con */
        .page-container {
            background-color: white;
            padding: 2rem 2.5rem; /* Tăng padding */
            border-radius: 1.5rem; /* bo tròn nhiều hơn */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border: 1px solid #e2e8f0; /* border-slate-200 */
        }

        /* (MỚI) Style cho các thẻ Persona */
        .persona-card {
            border: 2px solid #e2e8f0; /* border-slate-200 */
            transition: all 0.2s ease-in-out;
            background-color: #f8fafc; /* slate-50 */
        }
        .persona-radio:checked + .persona-card {
            border-color: #2563eb; /* brand-blue */
            background-color: #eff6ff; /* blue-50 */
            box-shadow: 0 4px 10px rgb(37 99 235 / 0.2);
            transform: translateY(-2px);
        }
        .persona-radio:checked + .persona-card .persona-icon {
            background-color: #2563eb;
            color: white;
        }
        .persona-radio:not(:checked) + .persona-card:hover {
            border-color: #94a3b8; /* slate-400 */
        }
        .persona-icon {
            transition: all 0.2s ease-in-out;
        }
    </style>
</head>

<body class="font-sans antialiased">

    <!-- Container chính -->
    <div class="container mx-auto max-w-7xl p-4 md:p-8">

        <!-- (MỚI) Header với Gradient -->
        <header class="mb-10 p-8 rounded-3xl bg-gradient-to-r from-brand-blue to-brand-indigo shadow-lg text-white">
            <div class="flex items-center gap-4">
                <!-- Icon Logo -->
                <svg class="h-12 w-12 shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                </svg>
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold">Công Cụ Hoạch Định Kỹ Năng BA</h1>
                    <p class="text-lg text-blue-100 mt-2 opacity-90">Xây dựng lộ trình nghề nghiệp Business Analyst của riêng bạn dựa trên dữ liệu thị trường.</p>
                </div>
            </div>
        </header>

        <!-- ===== TRANG LỰA CHỌN (BẮT ĐẦU) ===== -->
        <main id="selection-page" class="flex flex-col gap-8">
            <!-- (MỚI) Bước 1: Chọn Định Hướng (Thiết kế Card) -->
            <section class="page-container space-y-6">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-gray-200 pb-3">
                    Bước 1: Chọn Định Hướng (Tính Cách)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Card 1: Technical -->
                    <label>
                        <input type="radio" name="persona" value="technical" class="persona-radio sr-only" checked>
                        <div class="persona-card flex flex-col items-center p-6 rounded-2xl cursor-pointer h-full">
                            <div class="persona-icon bg-slate-100 text-slate-600 rounded-full p-3 mb-4">
                                <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5 0-4.5 16.5" />
                                </svg>
                            </div>
                            <strong class="font-semibold text-lg text-gray-900 mb-1">BA Kỹ Thuật</strong>
                            <p class="text-sm text-gray-500 text-center">Làm việc với dữ liệu, API, hệ thống.</p>
                        </div>
                    </label>
                    <!-- Card 2: Business -->
                    <label>
                        <input type="radio" name="persona" value="business" class="persona-radio sr-only">
                        <div class="persona-card flex flex-col items-center p-6 rounded-2xl cursor-pointer h-full">
                            <div class="persona-icon bg-slate-100 text-slate-600 rounded-full p-3 mb-4">
                                <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5l3 2.25-3 2.25m3 0h-3m-2.25 0l-3 2.25 3 2.25m0-4.5h3m-3 1.5l3 2.25-3 2.25m0-4.5h3m6.75 0l3 2.25-3 2.25m3 0h-3m-2.25 0l-3 2.25 3 2.25m0-4.5h3m-3 1.5l3 2.25-3 2.25m0-4.5h3" />
                                </svg>
                            </div>
                            <strong class="font-semibold text-lg text-gray-900 mb-1">BA Nghiệp Vụ</strong>
                            <p class="text-sm text-gray-500 text-center">Làm việc với quy trình, nghiệp vụ.</p>
                        </div>
                    </label>
                    <!-- Card 3: Leader -->
                    <label>
                        <input type="radio" name="persona" value="leader" class="persona-radio sr-only">
                        <div class="persona-card flex flex-col items-center p-6 rounded-2xl cursor-pointer h-full">
                            <div class="persona-icon bg-slate-100 text-slate-600 rounded-full p-3 mb-4">
                                <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0-3.05-3.05m0 0a9.094 9.094 0 0 0-3.05-3.05m3.05 3.05a9.094 9.094 0 0 1-3.05 3.05m0 0a9.094 9.094 0 0 1-3.05-3.05m-3.05 0a9.094 9.094 0 0 0-3.05 3.05m3.05-3.05a9.094 9.094 0 0 1 3.05-3.05M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                </svg>
                            </div>
                            <strong class="font-semibold text-lg text-gray-900 mb-1">BA Lãnh Đạo</strong>
                            <p class="text-sm text-gray-500 text-center">Làm việc với con người, đàm phán.</p>
                        </div>
                    </label>
                </div>
            </section>

            <!-- Bước 2: Chọn Kỹ Năng -->
            <section class="page-container">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-gray-200 pb-3 mb-6">
                    Bước 2: Đánh dấu các Kỹ Năng Bạn Đã Có
                </h2>
                <div id="skills-accordion" class="space-y-4">
                    <!-- JS sẽ điền vào đây -->
                </div>
            </section>

            <!-- Bước 3: Nút tạo kế hoạch -->
            <section class="page-container">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-gray-200 pb-3 mb-6">
                    Bước 3: Tạo Lộ Trình
                </h2>
                <p class="text-gray-600 mb-6">Sau khi hoàn thành Bước 1 và 2, hãy nhấn nút này để xem lộ trình phân tích dành riêng cho bạn.</p>
                <button id="generate-btn" class="w-full bg-gradient-to-r from-brand-blue to-brand-indigo text-white font-bold py-4 px-6 rounded-xl hover:shadow-xl hover:opacity-90 transition shadow-lg text-lg transform hover:-translate-y-1">
                    Tạo Kế Hoạch Phát Triển
                </button>
            </section>
        </main> <!-- Hết #selection-page -->

        <!-- ===== (MỚI) TRUNG TÂM LỘ TRÌNH (HUB) - ẨN ===== -->
        <main id="report-hub-page" class="hidden page-container animate-fade-in">
            <!-- Sẽ được JS điền vào -->
        </main>
        
        <!-- ===== (MỚI) TRANG CHI TIẾT VAI TRÒ - ẨN ===== -->
        <main id="persona-detail-page" class="hidden page-container animate-fade-in">
            <!-- Sẽ được JS điền vào -->
        </main>
        
        <!-- ===== (MỚI) TRANG CHI TIẾT NHÓM KỸ NĂNG - ẨN ===== -->
        <main id="skill-group-detail-page" class="hidden page-container animate-fade-in">
            <!-- Sẽ được JS điền vào -->
        </main>

    </div> <!-- Hết container -->

    <!-- ===== MODAL TỔNG QUAN (ẨN) ===== -->
    <div id="summary-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col scale-95 transform transition-transform duration-300" id="modal-content">
            <div class="p-6 border-b">
                <h3 class="text-2xl font-bold text-gray-800">Tổng quan Lựa chọn của Bạn</h3>
            </div>
            <div class="p-6 space-y-6 overflow-y-auto">
                <!-- Persona -->
                <div>
                    <h4 class="text-lg font-semibold text-brand-blue">1. Định Hướng (Tính Cách)</h4>
                    <p id="modal-persona" class="text-gray-700 text-lg font-medium"></p>
                </div>
                <!-- Skills -->
                <div>
                    <h4 class="text-lg font-semibold text-brand-blue">2. Kỹ Năng Hiện Có (<span id="modal-skill-count">0</span>)</h4>
                    <div id="modal-skills-list" class="flex flex-wrap gap-2 mt-2 max-h-60 overflow-y-auto p-3 bg-slate-50 rounded-lg border border-slate-200">
                        <span class="text-gray-500">Bạn chưa chọn kỹ năng nào.</span>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-slate-50 border-t rounded-b-2xl flex flex-col sm:flex-row justify-end gap-4">
                <button id="modal-close-btn" class="bg-slate-200 text-slate-700 font-bold py-2 px-5 rounded-lg hover:bg-slate-300 transition">
                    Chỉnh Sửa Lại
                </button>
                <button id="modal-confirm-btn" class="bg-gradient-to-r from-brand-blue to-brand-indigo text-white font-bold py-2 px-5 rounded-lg hover:opacity-90 transition">
                    Xác nhận & Tạo Lộ Trình
                </button>
            </div>
        </div>
    </div>
    <!-- ===== HẾT MODAL ===== -->

    <!-- ===== LOADER (ẨN) ===== -->
    <div id="loader-container" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-[60] hidden flex-col">
        <div id="loader"></div>
        <p class="text-white mt-4 text-lg">Đang phân tích và xây dựng kế hoạch...</p>
    </div>
    <!-- ===== HẾT LOADER ===== -->

    <!-- Script chính của ứng dụng -->
    <script>
        // (ĐÃ XÓA) mermaid.initialize

        // === DỮ LIỆU TỪ BÁO CÁO PHÂN TÍCH ===
        const allSkillsData = [
            // Technical Skills
            { "id": "sql", "name": "SQL", "count": 50, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "power bi", "name": "Power BI", "count": 25, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "tableau", "name": "Tableau", "count": 17, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "ai", "name": "AI", "count": 17, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "python", "name": "Python", "count": 17, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "oracle", "name": "Oracle", "count": 14, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "api", "name": "API", "count": 13, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "etl", "name": "ETL", "count": 12, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "database", "name": "Database", "count": 10, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "azure", "name": "Azure", "count": 9, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "mysql", "name": "MySQL", "count": 8, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "cloud", "name": "Cloud", "count": 7, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "java", "name": "Java", "count": 6, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "aws", "name": "AWS", "count": 6, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "devops", "name": "DevOps", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "postgresql", "name": "PostgreSQL", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "spark", "name": "Spark", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "nosql", "name": "NoSQL", "count": 5, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "data warehouse", "name": "Data Warehouse", "count": 4, "category": "Kỹ Năng Kỹ Thuật" },
            { "id": "big data", "name": "Big Data", "count": 4, "category": "Kỹ Năng Kỹ Thuật" },

            // Business Skills
            { "id": "agile", "name": "Agile", "count": 64, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "scrum", "name": "Scrum", "count": 44, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "jira", "name": "Jira", "count": 28, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "requirements", "name": "Requirements", "count": 26, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "business analysis", "name": "Business Analysis", "count": 24, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "confluence", "name": "Confluence", "count": 22, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "uml", "name": "UML", "count": 18, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "bpmn", "name": "BPMN", "count": 14, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "stakeholder", "name": "Stakeholder", "count": 13, "category": "Kỹ Năng Nghiệp Vụ" },
            { "id": "product owner", "name": "Product Owner", "count": 10, "category": "Kỹ Năng Nghiệp Vụ" },

            // Soft Skills
            { "id": "communication", "name": "Communication", "count": 50, "category": "Kỹ Năng Mềm" },
            { "id": "analytical", "name": "Analytical", "count": 38, "category": "Kỹ Năng Mềm" },
            { "id": "management", "name": "Management", "count": 28, "category": "Kỹ Năng Mềm" },
            { "id": "presentation", "name": "Presentation", "count": 11, "category": "Kỹ Năng Mềm" },
            { "id": "attention to detail", "name": "Attention to Detail", "count": 10, "category": "Kỹ Năng Mềm" },
            { "id": "collaboration", "name": "Collaboration", "count": 9, "category": "Kỹ Năng Mềm" },
            { "id": "critical thinking", "name": "Critical Thinking", "count": 9, "category": "Kỹ Năng Mềm" },
            { "id": "stakeholder management", "name": "Stakeholder Management", "count": 9, "category": "Kỹ Năng Mềm" },
            { "id": "negotiation", "name": "Negotiation", "count": 7, "category": "Kỹ Năng Mềm" },
            { "id": "mentoring", "name": "Mentoring", "count": 5, "category": "Kỹ Năng Mềm" },

            // Tools Platforms
            { "id": "excel", "name": "Excel", "count": 30, "category": "Công Cụ & Nền Tảng" },
            { "id": "figma", "name": "Figma", "count": 26, "category": "Công Cụ & Nền Tảng" },
            { "id": "visio", "name": "Visio", "count": 19, "category": "Công Cụ & Nền Tảng" },
            { "id": "draw.io", "name": "Draw.io", "count": 13, "category": "Công Cụ & Nền Tảng" },
            { "id": "teams", "name": "MS Teams", "count": 12, "category": "Công Cụ & Nền Tảng" },
            { "id": "powerpoint", "name": "PowerPoint", "count": 8, "category": "Công Cụ & Nền Tảng" },
            { "id": "sap", "name": "SAP", "count": 8, "category": "Công Cụ & Nền Tảng" },

            // Domain Skills
            { "id": "erp", "name": "ERP", "count": 24, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "banking", "name": "Banking", "count": 17, "category": "Kỹ Năng Lĩnh V vực" },
            { "id": "crm", "name": "CRM", "count": 16, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "fintech", "name": "Fintech", "count": 13, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "finance", "name": "Finance", "count": 13, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "education", "name": "Education", "count": 9, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "logistics", "name": "Logistics", "count": 7, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "payment", "name": "Payment", "count": 6, "category": "Kỹ Năng Lĩnh Vực" },
            { "id": "core banking", "name": "Core Banking", "count": 6, "category": "Kỹ Năng Lĩnh Vực" },

            // Languages
            { "id": "english", "name": "English", "count": 88, "category": "Ngoại Ngữ" },
            { "id": "japanese", "name": "Japanese", "count": 4, "category": "Ngoại Ngữ" },
            { "id": "chinese", "name": "Chinese", "count": 2, "category": "Ngoại Ngữ" }
        ];

        // Kỹ năng cốt lõi và mới nổi
        const coreSkillIds = ['english', 'agile', 'sql', 'communication', 'scrum'];
        const emergingSkillIds = ['sql', 'power bi', 'ai'];

        // (MỚI) Định nghĩa chi tiết vai trò
        const personaDefinitions = {
            technical: {
                title: "BA Kỹ Thuật (Technical BA)",
                description: "Tập trung vào 'LÀM THẾ NÀO' (How). Vai trò này bắc cầu giữa nghiệp vụ và đội ngũ kỹ thuật. Bạn sẽ làm việc sâu với dữ liệu, API, và cấu trúc hệ thống.",
                keySkills: ['sql', 'power bi', 'tableau', 'ai', 'python', 'database', 'api', 'etl'],
                responsibilities: [
                    "Phân tích và đặc tả yêu cầu phi chức năng (non-functional requirements) như hiệu suất, bảo mật.",
                    "Làm việc với CSDL (Database) để hiểu mô hình dữ liệu (data model).",
                    "Đặc tả API và các luồng tích hợp hệ thống (integration flows).",
                    "Hỗ trợ Dev Team gỡ lỗi (debug) và kiểm thử (testing) các tính năng phức tạp."
                ],
                caseStudy: "<strong>Ví dụ công việc:</strong> Khi công ty muốn tích hợp một cổng thanh toán mới, Technical BA sẽ là người ngồi xuống với đội ngũ kỹ thuật của bên thứ ba, đọc tài liệu API của họ, và sau đó thiết kế ra một sơ đồ trình tự (Sequence Diagram) mô tả chính xác cách hệ thống của công ty gọi và nhận dữ liệu từ API đó, bao gồm cả việc xử lý lỗi."
            },
            business: {
                title: "BA Nghiệp Vụ (Business BA)",
                description: "Tập trung vào 'CÁI GÌ' (What) và 'TẠI SAO' (Why). Vai trò này tập trung vào việc hiểu sâu các quy trình kinh doanh, xác định vấn đề và cơ hội.",
                keySkills: ['agile', 'scrum', 'requirements', 'business analysis', 'bpmn', 'uml', 'erp', 'banking', 'fintech'],
                responsibilities: [
                    "Phỏng vấn các bên liên quan (stakeholders) để tìm ra 'nỗi đau' (pain point) và nhu cầu thực sự.",
                    "Vẽ sơ đồ quy trình nghiệp vụ (Business Process Model) bằng BPMN hoặc UML.",
                    "Viết tài liệu đặc tả yêu cầu (BRD, User Stories) một cách rõ ràng, đầy đủ.",
                    "Tổ chức các buổi họp 'grooming' (làm mịn) backlog với team."
                ],
                caseStudy: "<strong>Ví dụ công việc:</strong> Khi phòng Kế toán phàn nàn rằng quy trình duyệt chi đang quá chậm, Business BA sẽ là người tổ chức các buổi phỏng vấn, ngồi xuống 'shadow' (quan sát) họ làm việc, vẽ ra quy trình hiện tại (As-Is), tìm ra các điểm nghẽn, và thiết kế một quy trình mới (To-Be) được tự động hóa trên phần mềm ERP, giúp giảm thời gian duyệt chi từ 3 ngày xuống còn 4 giờ."
            },
            leader: {
                title: "BA Lãnh Đạo (People BA / BA Lead)",
                description: "Tập trung vào 'AI' (Who) và 'CON NGƯỜI'. Vai trò này nhấn mạnh kỹ năng giao tiếp, đàm phán và quản lý.",
                keySkills: ['communication', 'management', 'stakeholder', 'stakeholder management', 'presentation', 'negotiation', 'mentoring', 'collaboration'],
                responsibilities: [
                    "Quản lý và điều phối một nhóm các BA khác trong dự án lớn.",
                    "Xây dựng và duy trì mối quan hệ với các bên liên quan cấp cao (C-level, Giám đốc dự án).",
                    "Tổ chức và thực hiện các buổi thuyết trình (Presentation) và Demo sản phẩm.",
                    "Đào tạo (mentoring) và phát triển các thành viên BA trong nhóm."
                ],
                caseStudy: "<strong>Ví dụ công việc:</strong> Trong một dự án phần mềm lớn, khi hai phòng ban (Marketing và Sales) có những yêu cầu mâu thuẫn nhau về tính năng của CRM, BA Lead sẽ là người tổ chức một buổi họp, đứng ra làm trung gian (facilitator), giúp hai bên đàm phán (negotiate) và đi đến một giải pháp dung hòa (win-win) mà vẫn đảm bảo mục tiêu chung của dự án."
            }
        };

        // (MỚI) Giải thích chi tiết về kỹ năng
        const skillDetails = {
            'sql': {
                description: "Ngôn ngữ truy vấn có cấu trúc (SQL) là công cụ nền tảng để làm việc với bất kỳ cơ sở dữ liệu quan hệ nào.",
                howItHelps: "Cho phép bạn tự mình lấy và xác minh dữ liệu, kiểm tra các giả thuyết nghiệp vụ, và hiểu sâu về cấu trúc data thay vì phải chờ đợi developer. Đây là kỹ năng phân biệt một BA 'tốt' và một BA 'xuất sắc'."
            },
            'power bi': {
                description: "Một công cụ trực quan hóa dữ liệu của Microsoft, giúp biến dữ liệu thô thành các biểu đồ và dashboard tương tác.",
                howItHelps: "Giúp bạn trình bày kết quả phân tích một cách trực quan và thuyết phục. Thay vì gửi file Excel, bạn gửi một dashboard động. Điều này giúp các sếp (stakeholders) ra quyết định nhanh hơn và chính xác hơn."
            },
            'ai': {
                description: "Trí tuệ nhân tạo (AI) đang dần được tích hợp vào các công cụ BA để phân tích dự đoán, nhận diện mẫu và tự động hóa.",
                howItHelps: "Là một BA hiểu về AI, bạn có thể đề xuất các giải pháp thông minh hơn (ví dụ: chatbot, hệ thống gợi ý sản phẩm) thay vì chỉ các tính năng cơ bản. Đây là kỹ năng 'đón đầu' giúp bạn có lợi thế cạnh tranh rất lớn."
            },
            'english': {
                description: "Ngoại ngữ, đặc biệt là tiếng Anh, là kỹ năng quan trọng nhất theo dữ liệu (88 lượt đề cập).",
                howItHelps: "Toàn bộ tài liệu chuyên ngành, tài liệu API, các khóa học tốt nhất (IIBA, PMI) đều bằng tiếng Anh. Giỏi tiếng Anh giúp bạn tiếp cận nguồn tri thức vô tận và làm việc với các đối tác, khách hàng global."
            },
            'agile': {
                description: "Là một phương pháp luận phát triển phần mềm linh hoạt, tập trung vào việc lặp lại (iteration) và phản hồi liên tục.",
                howItHelps: "Hầu hết các công ty công nghệ hiện nay đều chạy Agile/Scrum. Hiểu Agile giúp bạn hòa nhập ngay lập tức vào quy trình làm việc, biết cách viết User Story, tham gia các buổi họp (Sprint Planning, Retrospective) và giao sản phẩm nhanh chóng."
            },
            'scrum': {
                description: "Một 'framework' (khung làm việc) cụ thể và phổ biến nhất trong Agile, với các vai trò (Scrum Master, Product Owner) và sự kiện rõ ràng.",
                howItHelps: "Biết Scrum giúp bạn hiểu rõ vai trò của mình trong 'guồng máy' của team, cách team cam kết công việc, và làm thế nào để tối ưu hóa việc chuyển giao giá trị sau mỗi Sprint."
            },
            'communication': {
                description: "Kỹ năng giao tiếp là khả năng truyền đạt, lắng nghe và thấu hiểu thông tin một cách hiệu quả.",
                howItHelps: "Đây là 'dầu bôi trơn' cho mọi hoạt động của BA. Bạn dùng nó để phỏng vấn stakeholder, đàm phán yêu cầu, giải quyết xung đột, và trình bày giải pháp. Không có kỹ năng này, mọi kỹ thuật khác đều vô nghĩa."
            },
            'python': {
                description: "Ngôn ngữ lập trình đa năng, rất mạnh trong mảng Phân tích Dữ liệu và AI.",
                howItHelps: "Đối với Technical BA, Python giúp bạn làm những việc mà SQL/Excel không làm được: tự động hóa các tác vụ lặp lại (ví dụ: lấy dữ liệu từ web), xử lý các tập dữ liệu cực lớn, và thậm chí xây dựng các mô hình AI/ML đơn giản."
            },
            'requirements': {
                description: "Kỹ năng khơi gợi (Elicitation) và quản lý yêu cầu là cốt lõi của nghề BA.",
                howItHelps: "Giúp bạn đặt đúng câu hỏi để tìm ra nhu cầu 'chìm' (ẩn) của người dùng, phân biệt giữa 'Muốn' (Want) và 'Cần' (Need), và viết ra các yêu cầu rõ ràng, không mập mờ, để developer có thể lập trình đúng ngay từ đầu."
            },
            'bpmn': {
                description: "Business Process Model and Notation là một tiêu chuẩn vàng để vẽ sơ đồ quy trình nghiệp vụ.",
                howItHelps: "Giúp bạn mô hình hóa các quy trình phức tạp một cách trực quan và đồng nhất. Một biểu đồ BPMN chuẩn có thể được hiểu bởi cả sếp nghiệp vụ (để thấy luồng đi) và dev kỹ thuật (để cấu hình hệ thống)."
            },
            'management': {
                description: "Kỹ năng quản lý, bao gồm quản lý thời gian, phạm vi (scope) và con người.",
                howItHelps: "Khi bạn lên cấp (Senior/Lead), bạn không chỉ làm BA mà còn phải quản lý dự án. Kỹ năng này giúp bạn lập kế hoạch, theo dõi tiến độ, ngăn chặn 'scope creep' (yêu cầu phát sinh) và đảm bảo dự án đi đúng hướng."
            }
        };

        // Mối liên hệ kỹ năng
        const skillSynergies = {
            'sql': ['power bi', 'tableau', 'python', 'ai', 'database', 'etl'],
            'agile': ['scrum', 'jira', 'confluence'],
            'scrum': ['agile', 'jira'],
            'requirements': ['uml', 'bpmn', 'figma', 'visio', 'business analysis'],
            'communication': ['stakeholder management', 'presentation', 'negotiation', 'management'],
            'python': ['ai', 'spark', 'big data'],
            'database': ['sql', 'data warehouse', 'etl']
        };
        
        // Biến toàn cục
        let currentPlanData = {};

        // === KHỞI TẠO GIAO DIỆN ===
        document.addEventListener('DOMContentLoaded', () => {
            populateSkillsAccordion();
            document.getElementById('generate-btn').addEventListener('click', showSummaryModal);
            document.getElementById('modal-close-btn').addEventListener('click', hideSummaryModal);
            document.getElementById('modal-confirm-btn').addEventListener('click', confirmAndGenerate);
        });

        // Hàm điền các kỹ năng vào accordion
        function populateSkillsAccordion() {
            const container = document.getElementById('skills-accordion');
            const skillsByCategory = allSkillsData.reduce((acc, skill) => {
                const category = skill.category;
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(skill);
                return acc;
            }, {});

            const categoryOrder = ["Kỹ Năng Mềm", "Kỹ Năng Nghiệp Vụ", "Kỹ Năng Kỹ Thuật", "Công Cụ & Nền Tảng", "Kỹ Năng Lĩnh Vực", "Ngoại Ngữ"];
            
            for (const category of categoryOrder) {
                if (!skillsByCategory[category]) continue;

                const skills = skillsByCategory[category].sort((a,b) => b.count - a.count);
                const section = document.createElement('div');
                section.className = 'border border-gray-200 rounded-lg';

                const header = document.createElement('button');
                header.className = 'w-full flex justify-between items-center p-4 bg-slate-50 hover:bg-slate-100 transition rounded-t-lg';
                header.innerHTML = `
                    <span class="font-semibold text-gray-700">${category}</span>
                    <svg class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                `;

                const content = document.createElement('div');
                content.className = 'p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 border-t border-gray-200 hidden';
                
                skills.forEach(skill => {
                    const label = document.createElement('label');
                    label.className = 'flex items-center p-2 rounded hover:bg-slate-50 cursor-pointer';
                    label.innerHTML = `
                        <input type="checkbox" class="skill-checkbox h-4 w-4 rounded text-brand-blue" value="${skill.id}">
                        <span class="ml-2 text-sm text-gray-700">${skill.name} (${skill.count} lượt)</span>
                    `;
                    content.appendChild(label);
                });

                header.addEventListener('click', () => {
                    content.classList.toggle('hidden');
                    header.querySelector('svg').classList.toggle('rotate-180');
                });
                
                section.appendChild(header);
                section.appendChild(content);
                container.appendChild(section);
            }
        }

        // Hàm tìm kỹ năng bằng ID
        function findSkillById(id) {
            const skill = allSkillsData.find(s => s.id === id);
            if (!skill) {
                const exceptions = {
                    'stakeholder management': { id: 'stakeholder management', name: 'Stakeholder Management', count: 9 },
                };
                return exceptions[id] || { id: id, name: id, count: 'N/A' };
            }
            return skill;
        }


        // === CÁC HÀM XỬ LÝ MODAL ===
        function showSummaryModal() {
            const modal = document.getElementById('summary-modal');
            const modalContent = document.getElementById('modal-content');

            const selectedPersonaValue = document.querySelector('input[name="persona"]:checked').value;
            const selectedPersonaLabel = document.querySelector(`input[value="${selectedPersonaValue}"]`).closest('label').querySelector('strong').textContent;
            const userSkills = new Set();
            const userSkillNames = [];
            document.querySelectorAll('.skill-checkbox:checked').forEach(cb => {
                userSkills.add(cb.value);
                userSkillNames.push(cb.nextElementSibling.textContent.split(' (')[0]);
            });

            currentPlanData = {
                selectedPersona: selectedPersonaValue,
                userSkills: userSkills,
                selectedPersonaLabel: selectedPersonaLabel,
                userSkillNames: userSkillNames.sort()
            };

            document.getElementById('modal-persona').textContent = selectedPersonaLabel;
            const skillsListContainer = document.getElementById('modal-skills-list');
            document.getElementById('modal-skill-count').textContent = userSkillNames.length;

            if (userSkillNames.length > 0) {
                skillsListContainer.innerHTML = '';
                userSkillNames.forEach(name => {
                    const skillTag = document.createElement('span');
                    skillTag.className = 'bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full';
                    skillTag.textContent = name;
                    skillsListContainer.appendChild(skillTag);
                });
            } else {
                skillsListContainer.innerHTML = '<span class="text-gray-500 italic">Bạn chưa chọn kỹ năng nào.</span>';
            }

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
            }, 10);
        }

        function hideSummaryModal() {
            const modal = document.getElementById('summary-modal');
            const modalContent = document.getElementById('modal-content');

            modal.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function confirmAndGenerate() {
            hideSummaryModal();
            setTimeout(runPlanGeneration, 300);
        }

        // === (MỚI) HÀM ĐIỀU HƯỚNG TRANG CHÍNH ===
        function navigateToPage(pageId, data = {}) {
            // Ẩn tất cả các trang
            document.getElementById('selection-page').classList.add('hidden');
            document.getElementById('report-hub-page').classList.add('hidden');
            document.getElementById('persona-detail-page').classList.add('hidden');
            document.getElementById('skill-group-detail-page').classList.add('hidden');

            // Xử lý và hiển thị trang được yêu cầu
            switch (pageId) {
                case 'selection':
                    document.getElementById('selection-page').classList.remove('hidden');
                    break;
                case 'hub':
                    document.getElementById('report-hub-page').classList.remove('hidden');
                    break;
                case 'persona-detail':
                    buildPersonaDetailPage();
                    document.getElementById('persona-detail-page').classList.remove('hidden');
                    break;
                case 'skill-group-detail':
                    buildSkillGroupDetailPage(data.title, data.skills, data.color);
                    document.getElementById('skill-group-detail-page').classList.remove('hidden');
                    break;
            }
            window.scrollTo(0, 0); // Cuộn lên đầu trang
        }

        // === HÀM TẠO KẾ HOẠCH (BỘ NÃO) ===
        function runPlanGeneration() {
            const loader = document.getElementById('loader-container');
            const { selectedPersona, userSkills } = currentPlanData;
            
            loader.classList.remove('hidden');
            loader.classList.add('flex');
            document.getElementById('selection-page').classList.add('hidden');

            // 1. Phân tích thiếu hụt
            const coreGap = coreSkillIds
                .filter(id => !userSkills.has(id))
                .map(findSkillById)
                .sort((a,b) => b.count - a.count);

            const emergingGap = emergingSkillIds
                .filter(id => !userSkills.has(id))
                .map(findSkillById)
                .sort((a,b) => b.count - a.count);
                
            const personaDef = personaDefinitions[selectedPersona];
            const personaGap = personaDef.keySkills
                .filter(id => !userSkills.has(id))
                .map(findSkillById)
                .sort((a, b) => b.count - a.count);

            // (ĐÃ XÓA) allRecSkillObjects và allRecSkills không còn cần thiết cho Mermaid

            // 2. Lưu kết quả vào biến toàn cục
            currentPlanData.results = {
                coreGap,
                emergingGap,
                personaGap,
                personaDef
            };

            // 3. Giả lập thời gian
            setTimeout(() => {
                // 4. Xây dựng trang Hub
                buildReportHubPage();

                // 5. Ẩn loader, hiện trang Hub
                loader.classList.add('hidden');
                loader.classList.remove('flex');
                navigateToPage('hub'); // Hiển thị trang Hub

                // (ĐÃ XÓA) Không cần chạy Mermaid
            }, 1500);
        }

        // === (MỚI) CÁC HÀM XÂY DỰNG TRANG (BUILDERS) ===

        // (MỚI) Xây dựng Trang Hub (Bảng điều khiển)
        function buildReportHubPage() {
            const { personaDef, coreGap, personaGap, emergingGap } = currentPlanData.results;
            const hubPage = document.getElementById('report-hub-page');
            const totalMissing = coreGap.length + personaGap.length + emergingGap.length;

            let html = `
                <div class="flex flex-col sm:flex-row justify-between sm:items-center border-b-2 border-slate-200 pb-4 mb-8 gap-4">
                    <h2 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-brand-blue to-brand-indigo">
                        Lộ Trình Của Bạn
                    </h2>
                    <button class="nav-button w-full sm:w-auto bg-slate-200 text-slate-700 font-bold py-2 px-5 rounded-lg hover:bg-slate-300 transition shrink-0" data-page="selection">
                        &larr; Tạo Lộ Trình Mới
                    </button>
                </div>
                
                <!-- Thẻ Vai Trò -->
                <section class="mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl p-8 shadow-sm animate-fade-in">
                    <h3 class="text-xl font-bold text-gray-500 uppercase tracking-wider">Định Hướng Của Bạn</h3>
                    <h4 class="text-3xl font-bold text-brand-blue my-2">${personaDef.title}</h4>
                    <p class="text-lg text-gray-600 mt-2 mb-6 max-w-3xl">${personaDef.description}</p>
                    <button class="nav-button bg-brand-blue text-white font-bold py-2 px-6 rounded-lg hover:bg-brand-indigo transition transform hover:-translate-y-0.5" data-page="persona-detail">
                        Xem Chi Tiết Vai Trò &rarr;
                    </button>
                </section>

                <!-- (MỚI) Bảng điều hướng 3 bước -->
                <section class="animate-fade-in" style="animation-delay: 200ms;">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">Lộ Trình Đề Xuất (${totalMissing} Kỹ Năng)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        
                        <!-- Card: Cốt Lõi -->
                        <div class="flex flex-col bg-white border-2 border-yellow-300 rounded-2xl p-6 shadow-lg transition-transform transform hover:-translate-y-1 hover:shadow-xl">
                            <div class="flex-grow">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="flex-shrink-0 bg-yellow-100 text-yellow-700 p-3 rounded-full">
                                        <!-- Icon -->
                                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.717 50.717 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" /></svg>
                                    </span>
                                    <h4 class="text-xl font-bold text-gray-800">Bước 1: Cốt Lõi</h4>
                                </div>
                                <p class="text-gray-600 text-sm mb-4">Các kỹ năng bắt buộc phải có của mọi BA.</p>
                            </div>
                            <div class="text-center">
                                <p class="text-3xl font-bold text-yellow-600 mb-4">${coreGap.length} <span class="text-lg font-normal text-gray-500">kỹ năng</span></p>
                                <button class="nav-button w-full bg-yellow-500 text-yellow-900 font-bold py-2 px-4 rounded-lg hover:bg-yellow-600 transition" data-page="skill-group-detail" data-group="core" ${coreGap.length === 0 ? 'disabled' : ''}>
                                    ${coreGap.length === 0 ? 'Đã Hoàn Thành' : 'Xem Chi Tiết'}
                                </button>
                            </div>
                        </div>

                        <!-- Card: Chuyên Sâu -->
                        <div class="flex flex-col bg-white border-2 border-emerald-300 rounded-2xl p-6 shadow-lg transition-transform transform hover:-translate-y-1 hover:shadow-xl">
                            <div class="flex-grow">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="flex-shrink-0 bg-emerald-100 text-emerald-700 p-3 rounded-full">
                                        <!-- Icon -->
                                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.51-2.52.51 2.52-2.51-2.225m2.51-2.225-2.225 2.51m2.225-2.51.51 2.52M7.5 15.25l-1.03-1.03m0 0 .51-2.52.51 2.52-1.03 1.03m-1.03-1.03.51 2.52M9 12.75l-1.03-1.03m0 0 .51-2.52.51 2.52-1.03 1.03m-1.03-1.03.51 2.52M12 9.75l-1.03-1.03m0 0 .51-2.52.51 2.52-1.03 1.03m-1.03-1.03.51 2.52M15 12.75l-1.03-1.03m0 0 .51-2.52.51 2.52-1.03 1.03m-1.03-1.03.51 2.52M16.5 15.25l-1.03-1.03m0 0 .51-2.52.51 2.52-1.03 1.03m-1.03-1.03.51 2.52M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
                                    </span>
                                    <h4 class="text-xl font-bold text-gray-800">Bước 2: Chuyên Sâu</h4>
                                </div>
                                <p class="text-gray-600 text-sm mb-4">Kỹ năng dành riêng cho định hướng của bạn.</p>
                            </div>
                            <div class="text-center">
                                <p class="text-3xl font-bold text-emerald-600 mb-4">${personaGap.length} <span class="text-lg font-normal text-gray-500">kỹ năng</span></p>
                                <button class="nav-button w-full bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-600 transition" data-page="skill-group-detail" data-group="persona" ${personaGap.length === 0 ? 'disabled' : ''}>
                                    ${personaGap.length === 0 ? 'Đã Hoàn Thành' : 'Xem Chi Tiết'}
                                </button>
                            </div>
                        </div>

                        <!-- Card: Mới Nổi -->
                        <div class="flex flex-col bg-white border-2 border-indigo-300 rounded-2xl p-6 shadow-lg transition-transform transform hover:-translate-y-1 hover:shadow-xl">
                            <div class="flex-grow">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="flex-shrink-0 bg-indigo-100 text-indigo-700 p-3 rounded-full">
                                        <!-- Icon -->
                                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047l-4.858 4.858a1.125 1.125 0 0 0 0 1.59l4.858 4.858a8.252 8.252 0 0 1 5.962-13.785 8.25 8.25 0 0 1 5.962 13.785l4.858-4.858a1.125 1.125 0 0 0 0-1.59l-4.858-4.858Z" /></svg>
                                    </span>
                                    <h4 class="text-xl font-bold text-gray-800">Bước 3: Mới Nổi</h4>
                                </div>
                                <p class="text-gray-600 text-sm mb-4">Đón đầu xu hướng và tăng lợi thế cạnh tranh.</p>
                            </div>
                            <div class="text-center">
                                <p class="text-3xl font-bold text-indigo-600 mb-4">${emergingGap.length} <span class="text-lg font-normal text-gray-500">kỹ năng</span></p>
                                <button class="nav-button w-full bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-600 transition" data-page="skill-group-detail" data-group="emerging" ${emergingGap.length === 0 ? 'disabled' : ''}>
                                    ${emergingGap.length === 0 ? 'Đã Hoàn Thành' : 'Xem Chi Tiết'}
                                </button>
                            </div>
                        </div>

                    </div>
                </section>
            `;
            hubPage.innerHTML = html;
            addNavigationListeners(); // Gắn sự kiện cho các nút mới
        }

        // Xây dựng Trang Chi tiết Vai Trò
        function buildPersonaDetailPage() {
            const { personaDef } = currentPlanData.results;
            const page = document.getElementById('persona-detail-page');

            let html = `
                <div class="flex flex-col sm:flex-row justify-between sm:items-center border-b-2 border-slate-200 pb-4 mb-8 gap-4">
                    <button class="nav-button bg-slate-200 text-slate-700 font-bold py-2 px-5 rounded-lg hover:bg-slate-300 transition" data-page="hub">
                        &larr; Quay Về Lộ Trình
                    </button>
                    <h2 class="text-2xl md:text-3xl font-bold text-brand-blue text-right">${personaDef.title}</h2>
                </div>
                
                <p class="text-lg text-gray-600 leading-relaxed mb-8">${personaDef.description}</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Trách nhiệm chính -->
                    <div class="animate-slide-in-right" style="animation-delay: 100ms;">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Trách Nhiệm Chính Thường Gặp</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            ${personaDef.responsibilities.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>

                    <!-- Ví dụ tình huống -->
                    <div class="animate-slide-in-right" style="animation-delay: 200ms;">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Tình Huống Công Việc (Case Study)</h3>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 text-gray-700 leading-relaxed shadow-sm">
                            ${personaDef.caseStudy}
                        </div>
                    </div>
                </div>
            `;
            page.innerHTML = html;
            addNavigationListeners(); // Gắn sự kiện cho nút "Quay Về"
        }

        // Xây dựng Trang Chi tiết Nhóm Kỹ Năng
        function buildSkillGroupDetailPage(title, skills, color) {
            const page = document.getElementById('skill-group-detail-page');
            // (MỚI) Ánh xạ màu sắc
            const colors = {
                yellow: { text: 'text-yellow-700', bg: 'bg-yellow-100', border: 'border-yellow-200' },
                emerald: { text: 'text-emerald-700', bg: 'bg-emerald-100', border: 'border-emerald-200' },
                indigo: { text: 'text-indigo-700', bg: 'bg-indigo-100', border: 'border-indigo-200' }
            };
            const theme = colors[color] || { text: 'text-gray-700', bg: 'bg-gray-100', border: 'border-gray-200' };

            let html = `
                <div class="flex flex-col sm:flex-row justify-between sm:items-center border-b-2 border-slate-200 pb-4 mb-8 gap-4">
                    <button class="nav-button bg-slate-200 text-slate-700 font-bold py-2 px-5 rounded-lg hover:bg-slate-300 transition" data-page="hub">
                        &larr; Quay Về Lộ Trình
                    </button>
                    <h2 class="text-2xl md:text-3xl font-bold ${theme.text} text-right">${title}</h2>
                </div>
            `;

            if (skills.length === 0) {
                html += `<p class="text-emerald-700 font-medium text-lg bg-emerald-50 p-6 rounded-lg">Tuyệt vời! Bạn đã hoàn thiện các kỹ năng trong nhóm này.</p>`;
            } else {
                html += `<div class="space-y-6">`;
                skills.forEach((skill, index) => {
                    const detail = skillDetails[skill.id] || { description: "N/A", howItHelps: "Không có mô tả chi tiết." };
                    const synergy = skillSynergies[skill.id];

                    html += `
                        <div class="border border-gray-200 rounded-xl overflow-hidden shadow-sm animate-slide-in-right" style="animation-delay: ${index * 100}ms;">
                            <div class="${theme.bg} p-4 border-b ${theme.border}">
                                <h3 class="text-xl font-bold ${theme.text}">${skill.name}</h3>
                            </div>
                            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-2">Mô Tả Kỹ Năng</h4>
                                    <p class="text-gray-600">${detail.description}</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-2">Giúp Gì Trong Công Việc?</h4>
                                    <p class="text-gray-600">${detail.howItHelps}</p>
                                </div>
                            </div>
                            ${synergy ? `
                            <div class="p-4 bg-slate-50 border-t border-slate-200">
                                <p class="text-sm text-gray-600">
                                    <svg class="w-4 h-4 inline-block mr-1 text-sky-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                    <strong>Bổ trợ cho:</strong> ${synergy.map(s_id => findSkillById(s_id)?.name || s_id).join(', ')}
                                </p>
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                html += `</div>`;
            }

            page.innerHTML = html;
            addNavigationListeners(); // Gắn sự kiện cho nút "Quay Về"
        }

        // Gắn sự kiện cho các nút điều hướng
        function addNavigationListeners() {
            document.querySelectorAll('.nav-button').forEach(button => {
                // Hủy sự kiện cũ để tránh gắn lặp
                button.replaceWith(button.cloneNode(true));
            });
            
            document.querySelectorAll('.nav-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const page = e.currentTarget.dataset.page;
                    const group = e.currentTarget.dataset.group;
                    
                    if (page === 'skill-group-detail') {
                        const { coreGap, personaGap, emergingGap } = currentPlanData.results;
                        if (group === 'core') {
                            navigateToPage('skill-group-detail', { title: 'Chi Tiết Kỹ Năng Cốt Lõi', skills: coreGap, color: 'yellow' });
                        } else if (group === 'persona') {
                            navigateToPage('skill-group-detail', { title: 'Chi Tiết Kỹ Năng Chuyên Sâu', skills: personaGap, color: 'emerald' });
                        } else if (group === 'emerging') {
                            navigateToPage('skill-group-detail', { title: 'Chi Tiết Kỹ Năng Mới Nổi', skills: emergingGap, color: 'indigo' });
                        }
                    } else {
                        navigateToPage(page);
                    }
                });
            });
        }

        // (ĐÃ XÓA) Hàm generateMermaidCode

    </script>

</body>

</html>
