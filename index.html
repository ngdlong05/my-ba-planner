<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BA Career Roadmap Tool - Professional Edition</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Cấu hình Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-blue': '#0ea5e9', // sky-500
                        'brand-dark': '#0f172a', // slate-900
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'bounce-slow': 'bounce 3s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        },
                        slideUp: {
                            '0%': { opacity: 0, transform: 'translateY(30px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' },
                        }
                    }
                },
            },
        };
    </script>
    <style>
        /* Background Image chuyên nghiệp cho BA */
        body {
            background-image: linear-gradient(to bottom, rgba(248, 250, 252, 0.95), rgba(241, 245, 249, 0.98)), url('https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=2015&auto=format&fit=crop');
            background-attachment: fixed;
            background-size: cover;
            background-position: center;
            min-height: 100vh;
        }
        
        /* Tùy chỉnh thanh cuộn */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 5px; border: 2px solid #f1f5f9; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        .page-container {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.05), 0 8px 10px -6px rgb(0 0 0 / 0.01);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        /* Card selection styling */
        .persona-card {
            border: 2px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: white;
        }
        .persona-radio:checked + .persona-card {
            border-color: #0ea5e9; /* brand-blue */
            background-color: #f0f9ff; /* sky-50 */
            box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.15);
            transform: translateY(-4px);
        }
        .persona-radio:checked + .persona-card .persona-icon {
            background-color: #0ea5e9;
            color: white;
            transform: scale(1.1);
        }
        .persona-card:hover {
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }
        .persona-icon { transition: all 0.3s; }

        /* Custom Checkbox */
        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.25em;
            height: 1.25em;
            border: 2px solid #cbd5e1;
            border-radius: 0.25em;
            display: grid;
            place-content: center;
            transition: all 0.2s;
        }
        .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            background-color: white;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked {
            background-color: #0ea5e9;
            border-color: #0ea5e9;
        }
        .custom-checkbox:checked::before {
            transform: scale(1);
        }
    </style>
</head>

<body class="font-sans text-slate-800 antialiased selection:bg-sky-200 selection:text-sky-900">

    <div class="container mx-auto max-w-6xl p-4 md:p-8">

        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 bg-white/80 backdrop-blur-md p-6 rounded-3xl shadow-xl border border-white">
            <div class="flex items-center gap-5 mb-4 md:mb-0">
                <div class="bg-gradient-to-br from-sky-500 to-blue-600 text-white p-4 rounded-2xl shadow-lg transform transition hover:rotate-6">
                    <svg class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 tracking-tight" id="app-title">BA Career Planner</h1>
                    <p class="text-slate-500 text-base font-medium mt-1" id="app-subtitle">Data-driven roadmap & Actionable insights</p>
                </div>
            </div>
            
            <!-- Language Switcher -->
            <div class="flex bg-slate-200/50 p-1.5 rounded-xl backdrop-blur-sm">
                <button onclick="switchLanguage('vi')" id="btn-vi" class="px-5 py-2.5 rounded-lg text-sm font-bold transition-all shadow-sm bg-white text-sky-600">Tiếng Việt</button>
                <button onclick="switchLanguage('en')" id="btn-en" class="px-5 py-2.5 rounded-lg text-sm font-bold text-slate-500 hover:text-slate-700 hover:bg-slate-200/50 transition-all">English</button>
            </div>
        </header>

        <!-- ===== TRANG LỰA CHỌN ===== -->
        <main id="selection-page" class="flex flex-col gap-8 animate-slide-up">
            
            <!-- Bước 1: Chọn Định Hướng -->
            <section class="page-container">
                <h2 class="text-2xl font-bold text-slate-800 border-b border-slate-200 pb-4 mb-8 flex items-center gap-3">
                    <span class="bg-sky-100 text-sky-600 w-10 h-10 rounded-xl flex items-center justify-center text-lg shadow-sm">1</span>
                    <span id="step1-title">Chọn Định Hướng Phát Triển</span>
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Technical -->
                    <label class="relative group h-full">
                        <input type="radio" name="persona" value="technical" class="persona-radio sr-only" checked>
                        <div class="persona-card p-8 rounded-2xl h-full cursor-pointer hover:shadow-lg flex flex-col items-center text-center">
                            <div class="persona-icon bg-slate-50 w-16 h-16 rounded-2xl flex items-center justify-center text-slate-600 mb-6 shadow-inner">
                                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg>
                            </div>
                            <h3 class="font-bold text-xl mb-3 text-slate-800" id="role-tech-title">BA Kỹ Thuật</h3>
                            <p class="text-sm text-slate-500 leading-relaxed" id="role-tech-desc">Tập trung vào hệ thống, dữ liệu, API và giải pháp kỹ thuật.</p>
                        </div>
                    </label>
                    <!-- Business -->
                    <label class="relative group h-full">
                        <input type="radio" name="persona" value="business" class="persona-radio sr-only">
                        <div class="persona-card p-8 rounded-2xl h-full cursor-pointer hover:shadow-lg flex flex-col items-center text-center">
                            <div class="persona-icon bg-slate-50 w-16 h-16 rounded-2xl flex items-center justify-center text-slate-600 mb-6 shadow-inner">
                                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            </div>
                            <h3 class="font-bold text-xl mb-3 text-slate-800" id="role-biz-title">BA Nghiệp Vụ</h3>
                            <p class="text-sm text-slate-500 leading-relaxed" id="role-biz-desc">Tập trung vào quy trình, tối ưu hóa vận hành và nghiệp vụ.</p>
                        </div>
                    </label>
                    <!-- Leader -->
                    <label class="relative group h-full">
                        <input type="radio" name="persona" value="leader" class="persona-radio sr-only">
                        <div class="persona-card p-8 rounded-2xl h-full cursor-pointer hover:shadow-lg flex flex-col items-center text-center">
                            <div class="persona-icon bg-slate-50 w-16 h-16 rounded-2xl flex items-center justify-center text-slate-600 mb-6 shadow-inner">
                                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                            </div>
                            <h3 class="font-bold text-xl mb-3 text-slate-800" id="role-lead-title">BA Lãnh Đạo</h3>
                            <p class="text-sm text-slate-500 leading-relaxed" id="role-lead-desc">Tập trung vào quản lý con người, chiến lược và đàm phán.</p>
                        </div>
                    </label>
                </div>
            </section>

            <!-- Bước 2: Chọn Kỹ Năng -->
            <section class="page-container">
                <h2 class="text-2xl font-bold text-slate-800 border-b border-slate-200 pb-4 mb-8 flex items-center gap-3">
                    <span class="bg-sky-100 text-sky-600 w-10 h-10 rounded-xl flex items-center justify-center text-lg shadow-sm">2</span>
                    <span id="step2-title">Đánh dấu Kỹ Năng Bạn Đã Có</span>
                </h2>
                <p class="text-slate-500 mb-6 italic text-sm" id="skill-instruction">Hãy trung thực với bản thân để có lộ trình chính xác nhất.</p>
                <div id="skills-accordion" class="space-y-4">
                    <!-- JS sẽ render -->
                </div>
            </section>

            <!-- Bước 3: Nút Action -->
            <div class="flex justify-end pb-12">
                <button id="generate-btn" class="group bg-gradient-to-r from-sky-600 to-blue-700 text-white font-bold py-5 px-10 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition transform flex items-center gap-3 text-lg">
                    <span id="btn-generate">Tạo Lộ Trình Cá Nhân Hóa</span>
                    <svg class="w-6 h-6 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                </button>
            </div>

        </main>

        <!-- ===== CÁC TRANG KẾT QUẢ (ẨN) ===== -->
        <main id="report-hub-page" class="hidden animate-fade-in space-y-8 pb-12"></main>
        <main id="persona-detail-page" class="hidden animate-fade-in space-y-8 pb-12"></main>
        <main id="skill-group-detail-page" class="hidden animate-fade-in space-y-8 pb-12"></main>

    </div>

    <!-- ===== MODAL (ẨN) ===== -->
    <div id="summary-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg transform scale-95 transition-transform duration-300 border border-slate-100 overflow-hidden" id="modal-content">
            <div class="bg-slate-50 p-6 border-b border-slate-100">
                <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <svg class="w-5 h-5 text-sky-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
                    <span id="modal-title">Xác nhận thông tin</span>
                </h3>
            </div>
            <div class="p-8 space-y-6">
                <div>
                    <p class="text-xs text-slate-400 uppercase font-bold tracking-widest mb-2" id="modal-role-label">Định Hướng</p>
                    <div class="flex items-center gap-3">
                        <div class="bg-sky-100 p-2 rounded-lg text-sky-600">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                        </div>
                        <p id="modal-persona" class="text-xl font-bold text-slate-800"></p>
                    </div>
                </div>
                <div>
                    <p class="text-xs text-slate-400 uppercase font-bold tracking-widest mb-2" id="modal-skills-label">Kỹ năng đã chọn</p>
                    <div id="modal-skills-list" class="flex flex-wrap gap-2 max-h-48 overflow-y-auto pr-2"></div>
                </div>
            </div>
            <div class="p-6 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                <button id="modal-close-btn" class="px-5 py-2.5 text-slate-600 hover:bg-white hover:shadow-sm rounded-xl transition font-bold text-sm">Quay lại</button>
                <button id="modal-confirm-btn" class="px-6 py-2.5 bg-sky-600 text-white rounded-xl hover:bg-sky-700 transition font-bold shadow-lg shadow-sky-200 text-sm">Xác nhận & Phân tích</button>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div id="loader-container" class="fixed inset-0 bg-white/90 backdrop-blur-lg flex flex-col items-center justify-center z-50 hidden transition-all duration-500">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-sky-100 border-t-sky-600 rounded-full animate-spin mb-6"></div>
            <div class="absolute top-0 left-0 w-16 h-16 border-4 border-transparent border-b-blue-400 rounded-full animate-spin" style="animation-direction: reverse; animation-duration: 1.5s"></div>
        </div>
        <h3 class="text-xl font-bold text-slate-800 mb-2" id="loader-title">Đang xây dựng chiến lược...</h3>
        <p class="text-slate-500 text-sm animate-pulse" id="loader-text">Phân tích dữ liệu thị trường & tối ưu hóa lộ trình</p>
    </div>

    <script>
        // === 1. DỮ LIỆU NGÔN NGỮ (TRANSLATIONS) ===
        let currentLang = 'vi';

        const translations = {
            vi: {
                appTitle: "Công Cụ Hoạch Định Kỹ Năng BA",
                appSubtitle: "Xây dựng lộ trình nghề nghiệp Business Analyst chuyên nghiệp.",
                step1: "Chọn Định Hướng Phát Triển",
                roleTech: "BA Kỹ Thuật (Technical BA)",
                roleTechDesc: "Tập trung vào hệ thống, dữ liệu, API, SQL và giải pháp kỹ thuật chuyên sâu.",
                roleBiz: "BA Nghiệp Vụ (Business BA)",
                roleBizDesc: "Tập trung vào quy trình, tối ưu hóa vận hành, tài chính và giải quyết bài toán kinh doanh.",
                roleLead: "BA Lãnh Đạo (BA Lead)",
                roleLeadDesc: "Tập trung vào quản lý con người, chiến lược sản phẩm, đàm phán và mentoring.",
                step2: "Đánh dấu Kỹ Năng Bạn Đã Có",
                skillInstruction: "Hãy trung thực với bản thân để có lộ trình chính xác nhất.",
                btnGenerate: "Tạo Lộ Trình Cá Nhân Hóa",
                modalTitle: "Xác nhận thông tin đầu vào",
                modalRole: "Định Hướng Đã Chọn",
                modalSkills: "Hồ Sơ Kỹ Năng Hiện Tại",
                btnBack: "Chỉnh sửa",
                btnConfirm: "Xác nhận & Phân tích",
                loaderTitle: "Đang xây dựng chiến lược...",
                loader: "Đang phân tích dữ liệu từ 200+ tin tuyển dụng...",
                hubTitle: "Chiến Lược Phát Triển Sự Nghiệp",
                btnNew: "Tạo Lộ Trình Mới",
                yourRole: "Hồ Sơ Định Hướng",
                btnViewRole: "Xem Mô Tả Công Việc Chi Tiết",
                roadmapTitle: "Lộ Trình Hành Động Khuyến Nghị",
                stepCore: "Giai Đoạn 1: Xây Dựng Cốt Lõi",
                stepCoreDesc: "Nền tảng bắt buộc cho mọi BA chuyên nghiệp.",
                stepSpec: "Giai Đoạn 2: Phát Triển Chuyên Sâu",
                stepSpecDesc: "Kỹ năng định hình và nâng tầm vai trò của bạn.",
                stepNew: "Giai Đoạn 3: Đón Đầu Xu Hướng",
                stepNewDesc: "Gia tăng lợi thế cạnh tranh trong tương lai.",
                btnViewDetail: "Xem Chi Tiết & Hành Động",
                completed: "Đã Hoàn Thành Xuất Sắc",
                skills: "kỹ năng cần học",
                why: "Tại sao kỹ năng này quan trọng?",
                desc: "Định nghĩa",
                help: "Ứng dụng thực tế",
                action: "Hành động ngay",
                res: "Từ khóa/Tài liệu",
                prereq: "Điều kiện tiên quyết:",
                strategicAdvice: "Lời Khuyên Chiến Lược",
                cats: {
                    "Technical Skills": "Kỹ Năng Kỹ Thuật (Technical)",
                    "Business Skills": "Kỹ Năng Nghiệp Vụ (Business)",
                    "Soft Skills": "Kỹ Năng Mềm (Soft Skills)",
                    "Tools Platforms": "Công Cụ & Nền Tảng (Tools)",
                    "Domain Skills": "Kiến Thức Ngành (Domain)",
                    "Languages": "Ngoại Ngữ (Languages)"
                },
                priorityLabel: ["", "Ưu tiên 1: Nền Tảng", "Ưu tiên 2: Tiếp Theo", "Ưu tiên 3: Học Sau"],
                priorityReason: ["", "Kỹ năng gốc rễ, cần thiết để học các kỹ năng khác.", "Bạn đã có đủ nền tảng để học kỹ năng này.", "Nên học các kỹ năng nền tảng trước để dễ tiếp thu hơn."]
            },
            en: {
                appTitle: "BA Career Planner",
                appSubtitle: "Build your professional Business Analyst career roadmap.",
                step1: "Select Your Career Path",
                roleTech: "Technical BA",
                roleTechDesc: "Focus on systems, data, SQL, APIs, and technical architecture.",
                roleBiz: "Business BA",
                roleBizDesc: "Focus on processes, operations, finance, and business value.",
                roleLead: "BA Lead / Manager",
                roleLeadDesc: "Focus on people management, product strategy, and negotiation.",
                step2: "Select Your Current Skills",
                skillInstruction: "Be honest for the most accurate roadmap.",
                btnGenerate: "Generate Personalized Roadmap",
                modalTitle: "Confirm Input Data",
                modalRole: "Selected Path",
                modalSkills: "Current Skill Profile",
                btnBack: "Edit",
                btnConfirm: "Confirm & Analyze",
                loaderTitle: "Building Strategy...",
                loader: "Analyzing data from 200+ job postings...",
                hubTitle: "Career Development Strategy",
                btnNew: "Create New Plan",
                yourRole: "Career Profile",
                btnViewRole: "View Detailed Job Description",
                roadmapTitle: "Recommended Action Plan",
                stepCore: "Phase 1: Build Core Foundation",
                stepCoreDesc: "Mandatory foundation for every professional BA.",
                stepSpec: "Phase 2: Specialize",
                stepSpecDesc: "Skills that define and elevate your role.",
                stepNew: "Phase 3: Future Proofing",
                stepNewDesc: "Gain competitive advantage with trends.",
                btnViewDetail: "View Details & Actions",
                completed: "Successfully Completed",
                skills: "skills to learn",
                why: "Why is this important?",
                desc: "Definition",
                help: "Real-world Application",
                action: "Actionable Steps",
                res: "Keywords/Resources",
                prereq: "Prerequisites:",
                strategicAdvice: "Strategic Advice",
                cats: {
                    "Technical Skills": "Technical Skills",
                    "Business Skills": "Business Skills",
                    "Soft Skills": "Soft Skills",
                    "Tools Platforms": "Tools & Platforms",
                    "Domain Skills": "Domain Knowledge",
                    "Languages": "Languages"
                },
                priorityLabel: ["", "Priority 1: Foundation", "Priority 2: Next Step", "Priority 3: Learn Later"],
                priorityReason: ["", "Root skill, essential for learning others.", "You have the foundation ready for this.", "Learn foundation skills first for easier adoption."]
            }
        };

        // === 2. DỮ LIỆU KỸ NĂNG (FULL DATASET) ===
        const allSkillsData = [
            { id: "sql", name: "SQL", category: "Technical Skills" },
            { id: "power bi", name: "Power BI", category: "Technical Skills" },
            { id: "tableau", name: "Tableau", category: "Technical Skills" },
            { id: "ai", name: "AI / Machine Learning", category: "Technical Skills" },
            { id: "python", name: "Python", category: "Technical Skills" },
            { id: "api", name: "API / Integration", category: "Technical Skills" },
            { id: "database", name: "Database Design", category: "Technical Skills" },
            { id: "etl", name: "ETL / Data Pipeline", category: "Technical Skills" },
            { id: "azure", name: "Microsoft Azure", category: "Technical Skills" },
            { id: "aws", name: "AWS Cloud", category: "Technical Skills" },
            { id: "data warehouse", name: "Data Warehouse", category: "Technical Skills" },
            
            { id: "agile", name: "Agile Mindset", category: "Business Skills" },
            { id: "scrum", name: "Scrum Framework", category: "Business Skills" },
            { id: "requirements", name: "Requirements Elicitation", category: "Business Skills" },
            { id: "bpmn", name: "BPMN / Process Modeling", category: "Business Skills" },
            { id: "uml", name: "UML Diagrams", category: "Business Skills" },
            { id: "user stories", name: "User Stories", category: "Business Skills" },
            { id: "brd", name: "BRD / SRS Documentation", category: "Business Skills" },
            { id: "use cases", name: "Use Cases", category: "Business Skills" },

            { id: "communication", name: "Communication", category: "Soft Skills" },
            { id: "analytical", name: "Analytical Thinking", category: "Soft Skills" },
            { id: "stakeholder management", name: "Stakeholder Management", category: "Soft Skills" },
            { id: "presentation", name: "Presentation", category: "Soft Skills" },
            { id: "negotiation", name: "Negotiation", category: "Soft Skills" },
            { id: "problem solving", name: "Problem Solving", category: "Soft Skills" },
            { id: "critical thinking", name: "Critical Thinking", category: "Soft Skills" },
            { id: "mentoring", name: "Mentoring / Coaching", category: "Soft Skills" },

            { id: "jira", name: "Jira", category: "Tools Platforms" },
            { id: "confluence", name: "Confluence", category: "Tools Platforms" },
            { id: "excel", name: "Excel (Advanced)", category: "Tools Platforms" },
            { id: "figma", name: "Figma / Wireframing", category: "Tools Platforms" },
            { id: "visio", name: "Visio / Draw.io", category: "Tools Platforms" },
            { id: "sap", name: "SAP / ERP Tools", category: "Tools Platforms" },

            { id: "english", name: "English (Professional)", category: "Languages" },
            { id: "banking", name: "Banking Domain", category: "Domain Skills" },
            { id: "erp", name: "ERP Knowledge", category: "Domain Skills" },
            { id: "fintech", name: "Fintech", category: "Domain Skills" },
            { id: "finance", name: "Finance / Accounting", category: "Domain Skills" },
            { id: "crm", name: "CRM Systems", category: "Domain Skills" }
        ];

        // Logic phụ thuộc (Prerequisites Tree)
        const skillPrereqs = {
            'sql': ['power bi', 'tableau', 'ai', 'python', 'etl', 'data warehouse'],
            'database': ['sql', 'data warehouse'],
            'agile': ['scrum', 'jira', 'confluence'],
            'requirements': ['uml', 'bpmn', 'user stories', 'use cases', 'brd'],
            'communication': ['stakeholder management', 'negotiation', 'presentation', 'mentoring'],
            'analytical': ['problem solving', 'critical thinking'],
            'python': ['ai']
        };

        const coreSkillIds = ['english', 'agile', 'sql', 'communication', 'requirements', 'analytical', 'problem solving', 'excel'];
        const emergingSkillIds = ['power bi', 'ai', 'python', 'aws', 'azure', 'big data'];

        // === CHI TIẾT KỸ NĂNG KHỔNG LỒ (MASSIVE SKILL DETAILS) ===
        const skillDetails = {
            'sql': {
                vi: { 
                    desc: "Ngôn ngữ truy vấn cấu trúc để làm việc với dữ liệu.", 
                    help: "Giúp bạn tự lấy số liệu kiểm chứng mà không cần chờ Dev. Hiểu cấu trúc dữ liệu để viết tài liệu kỹ thuật tốt hơn.",
                    action: "Cài đặt MySQL Workbench. Thực hành các câu lệnh SELECT, WHERE, GROUP BY, JOIN trên bộ dữ liệu mẫu Northwind.",
                    res: "W3Schools SQL, HackerRank SQL"
                },
                en: { 
                    desc: "Standard language for relational database management.", 
                    help: "Allows independent data retrieval and verification. Crucial for data analysis and validating requirements.",
                    action: "Install MySQL. Practice SELECT, JOINs, GROUP BY on sample datasets.",
                    res: "W3Schools, Mode Analytics SQL Tutorial"
                }
            },
            'power bi': {
                vi: {
                    desc: "Công cụ BI của Microsoft để trực quan hóa dữ liệu.",
                    help: "Biến báo cáo Excel nhàm chán thành Dashboard tương tác. Giúp stakeholder ra quyết định nhanh dựa trên dữ liệu.",
                    action: "Tải Power BI Desktop (Free). Kết nối với một file Excel và thử vẽ biểu đồ Bar, Line, Pie.",
                    res: "Guy in a Cube (YouTube), Microsoft Learn"
                },
                en: {
                    desc: "Business analytics service by Microsoft.",
                    help: "Turn raw data into interactive insights. Essential for data-driven decision making.",
                    action: "Download Power BI Desktop. Create a simple dashboard from an Excel source.",
                    res: "Microsoft Power BI Documentation"
                }
            },
            'python': {
                vi: {
                    desc: "Ngôn ngữ lập trình đa năng, mạnh về xử lý dữ liệu.",
                    help: "Tự động hóa các tác vụ lặp lại, xử lý file Excel lớn mà Power BI bị chậm, hoặc phân tích dữ liệu nâng cao.",
                    action: "Học cú pháp cơ bản (biến, vòng lặp). Thử dùng thư viện Pandas để đọc file CSV.",
                    res: "Automate the Boring Stuff with Python"
                },
                en: {
                    desc: "Programming language for data analysis and automation.",
                    help: "Automate repetitive tasks and handle large datasets beyond Excel's limit.",
                    action: "Learn basics + Pandas library. Read a CSV file using Python.",
                    res: "Codecademy Python"
                }
            },
            'api': {
                vi: {
                    desc: "Cơ chế cho phép các phần mềm giao tiếp với nhau.",
                    help: "Hiểu cách FE và BE nói chuyện. Viết tài liệu đặc tả API (Swagger/OpenAPI) cho Dev.",
                    action: "Tải Postman. Thử gọi một API công khai (như OpenWeatherMap) để xem JSON trả về.",
                    res: "Postman Learning Center"
                },
                en: {
                    desc: "Application Programming Interface.",
                    help: "Understand system integration. Write clear API specifications for developers.",
                    action: "Download Postman. Make a GET request to a public API.",
                    res: "Restful API Design Guidelines"
                }
            },
            'agile': {
                vi: {
                    desc: "Tư duy phát triển phần mềm linh hoạt.",
                    help: "Thích nghi với thay đổi yêu cầu. Tập trung chuyển giao giá trị sớm cho khách hàng thay vì viết tài liệu quá nhiều.",
                    action: "Đọc Agile Manifesto. So sánh Agile vs Waterfall.",
                    res: "Agile Alliance"
                },
                en: {
                    desc: "Iterative approach to software delivery.",
                    help: "Adapt to change and deliver value faster.",
                    action: "Read the Agile Manifesto.",
                    res: "Agile Manifesto"
                }
            },
            'scrum': {
                vi: {
                    desc: "Framework phổ biến nhất để thực hiện Agile.",
                    help: "Hiểu vai trò của mình trong các sự kiện: Daily, Sprint Planning, Review, Retrospective.",
                    action: "Tìm hiểu về 3 vai trò, 5 sự kiện, 3 tạo tác (Artifacts) trong Scrum.",
                    res: "Scrum Guide 2020"
                },
                en: {
                    desc: "Framework for developing complex products.",
                    help: "Participate effectively in Sprint events.",
                    action: "Read the Scrum Guide.",
                    res: "Scrum.org"
                }
            },
            'requirements': {
                vi: {
                    desc: "Kỹ năng khơi gợi và thu thập yêu cầu.",
                    help: "Tránh việc xây dựng sai sản phẩm. Hiểu rõ 'User Need' (Cần) khác với 'User Want' (Muốn).",
                    action: "Luyện tập kỹ thuật '5 Whys' để tìm nguyên nhân gốc rễ vấn đề.",
                    res: "BABOK Guide - Elicitation"
                },
                en: {
                    desc: "Eliciting and gathering requirements.",
                    help: "Ensure the team builds the right thing.",
                    action: "Practice '5 Whys' technique.",
                    res: "IIBA BABOK"
                }
            },
            'bpmn': {
                vi: {
                    desc: "Chuẩn mô hình hóa quy trình nghiệp vụ.",
                    help: "Vẽ quy trình chuẩn hóa để cả Sếp (Business) và Dev (Tech) đều hiểu đúng luồng đi.",
                    action: "Dùng Draw.io hoặc Camunda vẽ lại quy trình 'Rút tiền tại ATM'.",
                    res: "BPMN 2.0 Poster"
                },
                en: {
                    desc: "Business Process Model and Notation.",
                    help: "Visualise business processes clearly for all stakeholders.",
                    action: "Model an 'ATM Withdrawal' process using BPMN.",
                    res: "Camunda BPMN Tutorial"
                }
            },
            'user stories': {
                vi: {
                    desc: "Cách viết yêu cầu dưới góc nhìn người dùng.",
                    help: "Giúp team hiểu giá trị mang lại cho user. Cấu trúc: As a... I want to... So that...",
                    action: "Viết 5 User Stories cho tính năng 'Đăng nhập'. Đừng quên Acceptance Criteria.",
                    res: "Mountain Goat Software"
                },
                en: {
                    desc: "Requirements written from end-user perspective.",
                    help: "Clarify value. Format: As a... I want to... So that...",
                    action: "Write 5 User Stories for a 'Login' feature with AC.",
                    res: "User Stories Applied (Mike Cohn)"
                }
            },
            'jira': {
                vi: {
                    desc: "Công cụ quản lý dự án Agile phổ biến nhất.",
                    help: "Quản lý Backlog, tạo User Story, theo dõi tiến độ Sprint và Bug.",
                    action: "Tạo tài khoản Jira Free. Thử tạo một Project Scrum và tạo vài Ticket.",
                    res: "Atlassian University"
                },
                en: {
                    desc: "Project tracking software.",
                    help: "Manage backlog, sprints, and bugs.",
                    action: "Sign up for Jira Free. Create a Scrum project.",
                    res: "Atlassian Documentation"
                }
            },
            'figma': {
                vi: {
                    desc: "Công cụ thiết kế giao diện (UI/UX).",
                    help: "Tạo Wireframe/Mockup để trực quan hóa yêu cầu cho Dev và Khách hàng xem trước.",
                    action: "Vẽ một màn hình 'Trang chủ' đơn giản bằng các khối hộp trong Figma.",
                    res: "Figma 101 for BAs"
                },
                en: {
                    desc: "Interface design tool.",
                    help: "Create wireframes/mockups to visualize requirements.",
                    action: "Create a simple 'Home Screen' wireframe.",
                    res: "Figma Community"
                }
            },
            'english': {
                vi: {
                    desc: "Tiếng Anh chuyên ngành CNTT/Business.",
                    help: "Đọc tài liệu gốc, làm việc với đối tác nước ngoài, tiếp cận kiến thức mới nhất.",
                    action: "Đọc 1 bài báo trên Medium về BA mỗi ngày bằng tiếng Anh.",
                    res: "Medium, IIBA Articles"
                },
                en: {
                    desc: "Professional English.",
                    help: "Access global knowledge base and work internationally.",
                    action: "Read one BA article in English daily.",
                    res: "Harvard Business Review, Medium"
                }
            },
            'communication': {
                vi: {
                    desc: "Giao tiếp, lắng nghe và truyền đạt.",
                    help: "Dầu bôi trơn cho dự án. Giúp giải quyết xung đột và đảm bảo mọi người hiểu đúng ý nhau.",
                    action: "Tập tóm tắt lại ý của người khác sau mỗi cuộc họp (Meeting Minutes).",
                    res: "Crucial Conversations (Book)"
                },
                en: {
                    desc: "Effective communication skills.",
                    help: "Ensure clarity and alignment among stakeholders.",
                    action: "Practice writing clear Meeting Minutes.",
                    res: "Effective Communication Courses"
                }
            },
            'excel': {
                vi: {
                    desc: "Kỹ năng bảng tính nâng cao.",
                    help: "Xử lý dữ liệu nhanh, Pivot Table, VLOOKUP để phân tích sơ bộ trước khi dùng tool xịn.",
                    action: "Học cách dùng Pivot Table và hàm VLOOKUP/XLOOKUP thành thạo.",
                    res: "ExcelJet"
                },
                en: {
                    desc: "Advanced Spreadsheet skills.",
                    help: "Quick data analysis using Pivot Tables and Lookups.",
                    action: "Master Pivot Tables and XLOOKUP.",
                    res: "Chandoo.org"
                }
            }
            // Các kỹ năng khác sẽ dùng default nếu chưa định nghĩa
        };

        // Persona Data
        const personaData = {
            technical: {
                keySkills: ['sql', 'api', 'database', 'python', 'tableau', 'azure', 'etl', 'data warehouse'],
                vi: { title: "BA Kỹ Thuật", desc: "Cầu nối giữa Business và Dev Team, chuyên sâu về thiết kế hệ thống và dữ liệu.", resp: ["Viết đặc tả API & Database", "Truy vấn dữ liệu phức tạp (SQL)", "Phân tích tích hợp hệ thống", "Hỗ trợ Dev debug lỗi logic"] },
                en: { title: "Technical BA", desc: "Bridge between Business and Dev, focusing on system design and data.", resp: ["API & DB Specifications", "Complex SQL Queries", "System Integration Analysis", "Technical Debugging Support"] }
            },
            business: {
                keySkills: ['requirements', 'bpmn', 'user stories', 'excel', 'figma', 'process modeling', 'use cases', 'brd'],
                vi: { title: "BA Nghiệp Vụ", desc: "Tối ưu hóa quy trình và giải quyết bài toán kinh doanh cốt lõi.", resp: ["Vẽ lưu đồ quy trình (BPMN)", "Khơi gợi & Quản lý yêu cầu", "Viết tài liệu BRD/SRS", "UAT Testing với người dùng"] },
                en: { title: "Business BA", desc: "Process optimization and solving business problems.", resp: ["Process Mapping (BPMN)", "Requirement Elicitation", "BRD/SRS Writing", "User Acceptance Testing"] }
            },
            leader: {
                keySkills: ['stakeholder management', 'presentation', 'negotiation', 'jira', 'confluence', 'mentoring', 'communication', 'agile'],
                vi: { title: "BA Lãnh Đạo", desc: "Quản lý kỳ vọng, con người và định hướng chiến lược sản phẩm.", resp: ["Đàm phán phạm vi dự án", "Quản lý Stakeholder khó tính", "Xây dựng Roadmap sản phẩm", "Đào tạo & Mentoring team BA"] },
                en: { title: "BA Lead", desc: "Managing expectations, people, and product strategy.", resp: ["Scope Negotiation", "Stakeholder Management", "Product Roadmap", "Team Mentoring"] }
            }
        };

        let currentPlanData = {};

        // === 3. HÀM XỬ LÝ NGÔN NGỮ ===
        function switchLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            const btnVi = document.getElementById('btn-vi');
            const btnEn = document.getElementById('btn-en');
            
            if (lang === 'vi') {
                btnVi.className = "px-5 py-2.5 rounded-lg text-sm font-bold transition-all shadow-sm bg-white text-sky-600";
                btnEn.className = "px-5 py-2.5 rounded-lg text-sm font-bold text-slate-500 hover:text-slate-700 hover:bg-slate-200/50 transition-all";
            } else {
                btnEn.className = "px-5 py-2.5 rounded-lg text-sm font-bold transition-all shadow-sm bg-white text-sky-600";
                btnVi.className = "px-5 py-2.5 rounded-lg text-sm font-bold text-slate-500 hover:text-slate-700 hover:bg-slate-200/50 transition-all";
            }

            document.getElementById('app-title').innerText = t.appTitle;
            document.getElementById('app-subtitle').innerText = t.appSubtitle;
            document.getElementById('step1-title').innerText = t.step1;
            document.getElementById('role-tech-title').innerText = t.roleTech;
            document.getElementById('role-tech-desc').innerText = t.roleTechDesc;
            document.getElementById('role-biz-title').innerText = t.roleBiz;
            document.getElementById('role-biz-desc').innerText = t.roleBizDesc;
            document.getElementById('role-lead-title').innerText = t.roleLead;
            document.getElementById('role-lead-desc').innerText = t.roleLeadDesc;
            document.getElementById('step2-title').innerText = t.step2;
            document.getElementById('skill-instruction').innerText = t.skillInstruction;
            document.getElementById('btn-generate').firstElementChild.innerText = t.btnGenerate;
            document.getElementById('modal-title').innerText = t.modalTitle;
            document.getElementById('modal-role-label').innerText = t.modalRole;
            document.getElementById('modal-skills-label').innerText = t.modalSkills;
            document.getElementById('modal-close-btn').innerText = t.btnBack;
            document.getElementById('modal-confirm-btn').innerText = t.btnConfirm;
            document.getElementById('loader-text').innerText = t.loader;
            document.getElementById('loader-title').innerText = t.loaderTitle;

            populateSkillsAccordion();
            if (!document.getElementById('report-hub-page').classList.contains('hidden')) {
                buildReportHubPage();
            }
        }

        // === 4. LOGIC CHÍNH ===
        
        function populateSkillsAccordion() {
            const container = document.getElementById('skills-accordion');
            container.innerHTML = ''; 
            
            const cats = {};
            allSkillsData.forEach(skill => {
                if (!cats[skill.category]) cats[skill.category] = [];
                cats[skill.category].push(skill);
            });

            const t = translations[currentLang];
            
            Object.keys(cats).forEach(catKey => {
                const skills = cats[catKey];
                const groupDiv = document.createElement('div');
                groupDiv.className = 'border border-slate-200 rounded-xl bg-white overflow-hidden shadow-sm';
                
                const displayCat = t.cats[catKey] || catKey;

                const header = document.createElement('button');
                header.className = 'w-full flex justify-between items-center p-5 bg-slate-50 hover:bg-white transition-colors text-left font-bold text-slate-700 border-b border-slate-100';
                header.innerHTML = `
                    <span>${displayCat}</span>
                    <svg class="w-5 h-5 text-slate-400 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                `;

                const content = document.createElement('div');
                content.className = 'p-5 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 hidden';

                skills.forEach(skill => {
                    const label = document.createElement('label');
                    label.className = 'flex items-center gap-3 p-3 rounded-lg hover:bg-sky-50 cursor-pointer transition border border-transparent hover:border-sky-100';
                    label.innerHTML = `
                        <input type="checkbox" value="${skill.id}" class="custom-checkbox text-sky-600">
                        <span class="text-sm font-medium text-slate-700">${skill.name}</span>
                    `;
                    content.appendChild(label);
                });

                header.addEventListener('click', () => {
                    content.classList.toggle('hidden');
                    header.querySelector('svg').classList.toggle('rotate-180');
                });

                groupDiv.appendChild(header);
                groupDiv.appendChild(content);
                container.appendChild(groupDiv);
            });
        }

        document.getElementById('generate-btn').addEventListener('click', () => {
            const modal = document.getElementById('summary-modal');
            const roleVal = document.querySelector('input[name="persona"]:checked').value;
            const roleName = translations[currentLang][roleVal === 'technical' ? 'roleTech' : roleVal === 'business' ? 'roleBiz' : 'roleLead'];
            
            document.getElementById('modal-persona').innerText = roleName;
            
            const selectedSkills = Array.from(document.querySelectorAll('.custom-checkbox:checked')).map(cb => {
                return cb.nextElementSibling.innerText;
            });
            
            const list = document.getElementById('modal-skills-list');
            list.innerHTML = selectedSkills.length 
                ? selectedSkills.map(s => `<span class="bg-sky-100 text-sky-800 px-3 py-1.5 rounded-md text-xs font-bold border border-sky-200">${s}</span>`).join('')
                : `<span class="text-slate-400 italic">${currentLang === 'vi' ? 'Chưa chọn kỹ năng nào' : 'No skills selected'}</span>`;

            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
        });

        document.getElementById('modal-close-btn').addEventListener('click', () => {
            const modal = document.getElementById('summary-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        });

        document.getElementById('modal-confirm-btn').addEventListener('click', () => {
            document.getElementById('summary-modal').classList.add('hidden');
            runAnalysis();
        });

        function runAnalysis() {
            const loader = document.getElementById('loader-container');
            loader.classList.remove('hidden');
            
            const roleVal = document.querySelector('input[name="persona"]:checked').value;
            const userSkills = new Set(Array.from(document.querySelectorAll('.custom-checkbox:checked')).map(cb => cb.value));
            
            const coreMissing = coreSkillIds.filter(id => !userSkills.has(id));
            const roleMissing = personaData[roleVal].keySkills.filter(id => !userSkills.has(id));
            const newMissing = emergingSkillIds.filter(id => !userSkills.has(id));

            currentPlanData = { roleVal, coreMissing, roleMissing, newMissing, userSkills };

            setTimeout(() => {
                loader.classList.add('hidden');
                document.getElementById('selection-page').classList.add('hidden');
                document.getElementById('report-hub-page').classList.remove('hidden');
                buildReportHubPage();
                window.scrollTo(0, 0);
            }, 2000); // Giả lập thời gian phân tích
        }

        function buildReportHubPage() {
            const t = translations[currentLang];
            const hub = document.getElementById('report-hub-page');
            const { roleVal, coreMissing, roleMissing, newMissing } = currentPlanData;
            const pData = personaData[roleVal][currentLang];
            
            // Logic lời khuyên chiến lược
            let strategyAdvice = "";
            const totalMissing = coreMissing.length + roleMissing.length + newMissing.length;
            if (totalMissing > 15) {
                strategyAdvice = currentLang === 'vi' ? "Bạn đang ở giai đoạn khởi đầu. Đừng quá áp lực, hãy tập trung toàn lực vào Giai đoạn 1 (Cốt lõi) trong 3 tháng tới." : "You are at the beginning. Focus entirely on Phase 1 (Core) for the next 3 months.";
            } else if (totalMissing > 5) {
                strategyAdvice = currentLang === 'vi' ? "Nền tảng của bạn khá ổn. Hãy bắt đầu các dự án thực tế (Portfolio) với các kỹ năng chuyên sâu để tạo sự khác biệt." : "Your foundation is solid. Start building a Portfolio with specialized skills.";
            } else {
                strategyAdvice = currentLang === 'vi' ? "Hồ sơ của bạn rất mạnh! Hãy tập trung vào kỹ năng Lãnh đạo và các công nghệ mới (AI) để bứt phá thu nhập." : "Strong profile! Focus on Leadership and AI to maximize your value.";
            }

            hub.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-extrabold text-slate-800 tracking-tight">${t.hubTitle}</h2>
                    <button onclick="resetApp()" class="text-sm font-bold text-sky-600 hover:text-sky-800 flex items-center gap-1 bg-white px-4 py-2 rounded-lg shadow-sm hover:shadow transition">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                        ${t.btnNew}
                    </button>
                </div>

                <!-- Role Card -->
                <div class="page-container bg-gradient-to-br from-sky-50 to-blue-50 border-sky-200 overflow-hidden relative">
                    <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-sky-100 rounded-full opacity-50 blur-2xl"></div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xs font-black text-sky-500 uppercase tracking-widest mb-2">${t.yourRole}</h3>
                                <h4 class="text-4xl font-black text-slate-800 mb-3">${pData.title}</h4>
                                <p class="text-lg text-slate-600 mb-6 max-w-3xl font-medium">${pData.desc}</p>
                            </div>
                            <div class="hidden md:block bg-white/60 p-4 rounded-xl backdrop-blur-sm border border-white/50 shadow-sm">
                                <p class="text-xs font-bold text-slate-400 uppercase mb-1">${t.strategicAdvice}</p>
                                <p class="text-sm font-semibold text-slate-700 max-w-xs italic">"${strategyAdvice}"</p>
                            </div>
                        </div>
                        <div class="bg-white/80 p-5 rounded-2xl shadow-sm border border-white/60">
                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${pData.resp.map(r => `<li class="flex items-center gap-2 text-sm font-medium text-slate-700"><svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg>${r}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="mt-6 flex justify-end">
                             <button onclick="showDetail('2')" class="text-sm font-bold text-sky-700 hover:text-sky-900 flex items-center gap-1 hover:underline transition">${t.btnViewRole} →</button>
                        </div>
                    </div>
                </div>

                <h3 class="text-2xl font-bold text-slate-800 mt-10 mb-6 flex items-center gap-2">
                    <span class="bg-slate-800 w-2 h-8 rounded-full"></span>
                    ${t.roadmapTitle}
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    ${renderStepCard(1, t.stepCore, t.stepCoreDesc, coreMissing, 'yellow')}
                    ${renderStepCard(2, t.stepSpec, t.stepSpecDesc, roleMissing, 'sky')}
                    ${renderStepCard(3, t.stepNew, t.stepNewDesc, newMissing, 'indigo')}
                </div>
            `;
        }

        function renderStepCard(step, title, desc, missingList, color) {
            const t = translations[currentLang];
            const isDone = missingList.length === 0;
            const count = missingList.length;
            
            const styles = {
                yellow: { border: 'border-amber-400', bg: 'bg-amber-50', text: 'text-amber-900', icon: 'text-amber-500', btn: 'bg-amber-500 hover:bg-amber-600' },
                sky: { border: 'border-sky-400', bg: 'bg-sky-50', text: 'text-sky-900', icon: 'text-sky-500', btn: 'bg-sky-500 hover:bg-sky-600' },
                indigo: { border: 'border-indigo-400', bg: 'bg-indigo-50', text: 'text-indigo-900', icon: 'text-indigo-500', btn: 'bg-indigo-500 hover:bg-indigo-600' }
            };
            
            const style = styles[color];
            
            const btnContent = isDone 
                ? `<span class="flex items-center justify-center gap-2 text-green-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>${t.completed}</span>`
                : `<button onclick="showDetail('${step}')" class="w-full py-3 rounded-xl ${style.btn} text-white font-bold shadow-md hover:shadow-lg transition transform hover:-translate-y-0.5 flex items-center justify-center gap-2">${t.btnViewDetail} <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg></button>`;

            return `
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col h-full hover:shadow-md transition-shadow relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1.5 ${style.bg.replace('bg-', 'bg-gradient-to-r from-white via-') + '-400 to-white'}"></div>
                    <div class="flex-grow">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h4 class="font-bold text-xl text-slate-800 mb-1">${title}</h4>
                                <p class="text-xs text-slate-500 font-medium uppercase tracking-wide">${desc}</p>
                            </div>
                            <div class="${style.bg} p-2 rounded-lg ${style.icon}">
                                <span class="text-2xl font-black">${isDone ? '✓' : count}</span>
                            </div>
                        </div>
                        <div class="space-y-2 mb-6">
                            ${missingList.slice(0, 3).map(id => `<div class="text-sm text-slate-600 flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-slate-300"></span>${allSkillsData.find(s=>s.id===id)?.name}</div>`).join('')}
                            ${count > 3 ? `<div class="text-xs text-slate-400 font-medium pl-3.5">+ ${count - 3} ${t.skills}</div>` : ''}
                        </div>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-50">
                        ${btnContent}
                    </div>
                </div>
            `;
        }

        function showDetail(step) {
            const t = translations[currentLang];
            let skills = [];
            let title = "";
            let desc = "";
            
            if(step == 1) { skills = currentPlanData.coreMissing; title = t.stepCore; desc = t.stepCoreDesc; }
            if(step == 2) { skills = currentPlanData.roleMissing; title = t.stepSpec; desc = t.stepSpecDesc; }
            if(step == 3) { skills = currentPlanData.newMissing; title = t.stepNew; desc = t.stepNewDesc; }

            const page = document.getElementById('skill-group-detail-page');
            document.getElementById('report-hub-page').classList.add('hidden');
            page.classList.remove('hidden');
            window.scrollTo(0, 0);

            page.innerHTML = `
                <div class="flex items-center gap-4 mb-8">
                    <button onclick="backToHub()" class="bg-white border border-slate-200 p-2.5 rounded-xl text-slate-500 hover:text-sky-600 hover:border-sky-200 hover:shadow-sm transition">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                    </button>
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">${title}</h2>
                        <p class="text-sm text-slate-500 font-medium">${desc}</p>
                    </div>
                </div>
                <div class="space-y-6">
                    ${skills.length === 0 
                        ? `<div class="text-center p-12 bg-white rounded-2xl border border-dashed border-slate-300"><p class="text-lg text-slate-400 font-medium">🎉 ${t.completed}</p></div>` 
                        : skills.map(id => renderSkillItem(id)).join('')}
                </div>
            `;
        }

        function renderSkillItem(id) {
            const t = translations[currentLang];
            const skill = allSkillsData.find(s => s.id === id);
            const detailRaw = skillDetails[id] || { vi: {desc: "Đang cập nhật...", help: "...", action: "...", res: "Google"}, en: {desc: "Updating...", help: "...", action: "...", res: "Google"} };
            const detail = detailRaw[currentLang];
            
            const prereqList = skillPrereqs[id] || [];
            const missingPrereqs = prereqList.filter(pId => !currentPlanData.userSkills.has(pId));
            
            let statusBadge = '';
            let borderClass = 'border-l-4 border-l-sky-500'; // Default Blue
            
            if(missingPrereqs.length > 0) {
                borderClass = 'border-l-4 border-l-red-400';
                statusBadge = `<span class="inline-flex items-center gap-1 px-2.5 py-0.5 rounded text-xs font-bold bg-red-100 text-red-700">⚠️ ${t.priorityLabel[3]}</span>`;
            } else if (Object.values(skillPrereqs).flat().includes(id)) {
                borderClass = 'border-l-4 border-l-emerald-500';
                statusBadge = `<span class="inline-flex items-center gap-1 px-2.5 py-0.5 rounded text-xs font-bold bg-emerald-100 text-emerald-700">🌱 ${t.priorityLabel[1]}</span>`;
            } else {
                statusBadge = `<span class="inline-flex items-center gap-1 px-2.5 py-0.5 rounded text-xs font-bold bg-sky-100 text-sky-700">🚀 ${t.priorityLabel[2]}</span>`;
            }

            return `
                <div class="page-container p-0 overflow-hidden ${borderClass} shadow-md hover:shadow-lg transition-shadow">
                    <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div>
                            <h3 class="text-xl font-bold text-slate-800 flex items-center gap-3">
                                ${skill.name}
                                ${statusBadge}
                            </h3>
                            <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider mt-1 block">${t.cats[skill.category] || skill.category}</span>
                        </div>
                        ${missingPrereqs.length > 0 
                            ? `<div class="text-xs text-red-600 bg-red-50 px-3 py-2 rounded-lg font-medium border border-red-100">
                                ${t.prereq} <span class="font-bold">${missingPrereqs.map(pid => allSkillsData.find(s=>s.id===pid)?.name).join(', ')}</span>
                               </div>` 
                            : ''}
                    </div>
                    
                    <div class="p-6 bg-slate-50/50">
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <div>
                                    <p class="text-xs font-extrabold text-slate-400 uppercase mb-1 flex items-center gap-1"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> ${t.desc}</p>
                                    <p class="text-sm text-slate-700 leading-relaxed">${detail.desc}</p>
                                </div>
                                <div>
                                    <p class="text-xs font-extrabold text-slate-400 uppercase mb-1 flex items-center gap-1"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg> ${t.help}</p>
                                    <p class="text-sm text-slate-700 leading-relaxed">${detail.help}</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-slate-200 p-5 shadow-sm">
                                <p class="text-xs font-extrabold text-sky-600 uppercase mb-3 flex items-center gap-1"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg> ${t.action}</p>
                                <p class="text-sm text-slate-800 font-medium mb-4">${detail.action}</p>
                                <div class="pt-4 border-t border-slate-100">
                                    <p class="text-xs font-bold text-slate-400 uppercase mb-1">${t.res}</p>
                                    <p class="text-xs text-sky-600 font-medium bg-sky-50 inline-block px-2 py-1 rounded border border-sky-100">${detail.res}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function backToHub() {
            document.getElementById('skill-group-detail-page').classList.add('hidden');
            document.getElementById('report-hub-page').classList.remove('hidden');
        }

        function resetApp() {
            location.reload();
        }

        // Init
        populateSkillsAccordion();
    </script>
</body>
</html>
